# 水印方案说明文档

## 3.5

   add print water-mark

## 3.2.1

    跨域移除iframe报错，加上try catch
    拷贝文字截取，超过指定长度，截取前面和后面

## 3.2

    修复firefox postMessage必须制定域的问题

## 3.1

    水印uid和时间单独转32进制在进行拼接
    项目改为ts
    废弃water-mark分支

## 3.0

    webpack 升级到4.0，配置也做相应修改
    拷贝内容去掉空格
    处理body替换的情况

[水印对抗](http://0c7566aa.wiz03.com/share/s/0ctmqG2TXk8C2eM7h_1hoGQ-0WLfCA2SlQUY2iaPXy3mHmQY)

```js
    var oldBody = document.body;
    var newBody = oldBody.cloneNode(true);
    oldBody.parentNode.replaceChild(newBody, oldBody);
```

    代码进行重构，对utils进行拆分
    用户指纹存储到iframe里面，能够标识浏览器唯一实例
    去掉原有指纹存储方案，指纹统一从iframe里面拿，没有再生成一个新的存储到iframe里面，同时外面域名存储一份水印

## 2.5.15

    水印存储同步localStorage和cookie 两边同步存储

## 2.5.13

    水印时间对比和服务端返回的时间做对比

## 2.5.12

    保留原有hash 前面时间发生变化hash不变

## 2.5.11

    每天一个新指纹，把日期也放在指纹上

## 2.5.9

    指纹初始生成的时候加上用户id和系统id，方便追踪初始指纹生成者
    上报用户具体修改了水印什么属性

## 2.5.8

    把指纹写到浏览器cookie,让用户请求带上指纹，具体参数在请求的url里面 **modify-style-props** 这个参数

## 2.5.7

    打印误报告警处理

## 2.5.6

    iphone移动端误报水印情况，用户使用的uc或者qq浏览器，可能是内部插件问题，导致水印误报，iphone手机端不上报
    记录用户打开浏览器控制台
    上报数据带上版本信息

## 2.5.5

    因为客服浏览器兼容系问题去掉暗水印

## 2.5.4

    去掉指纹，改用hash

## 2.5.3

    测试加上浏览器指纹
    去掉最容易影响指纹波动的参数

## 2.5.1

    页面绘制水印 字体修改，方便识别1和l

## 2.5

    程序数据发送频率监测，过于频繁阻塞程序运行并且提示用户
    fix config document.body

## 2.4

    重构addLog
    添加收集用户配置数据接口

## 2.3

    支持https

## 2.2

  巴西后缀改为z
  水印被禁用添加监控和提示

## 2.1

    显示文案缩短，把数字转换为32进制显示
    暗水印密度单独设置

    2.1.1 发生错误的时候不转为32进制，需要显示原有信息

## 2.0

    水印数据脱敏，系统id加上用户id 得到唯一key值，缩短页面显示文案

    之前项目只是一个文件，但是随着需求的增加代码的复杂度也在随着增加，因此项目现在独立使用webpack进行构建，并代码进行拆分，使用es6重构代码

    加入eslint对代码质量进行监测，提高代码质量

    代码发布到dist使用命令npm run build,现阶段代码进入稳定期，不会有太大改动，所有代码没有加入监听功能，只支持最后的发布命令

## 1.9.0

    加密服务处问题，去掉代码加密，
    水印监听机制修改，提升性能

## 1.8.0

    开放支持文字样式调整

## 1.7.0

    加上后端数据统计

## 1.6.0

    水印失效测试

## 1.5.0

    加上盲水印
    用户截图可能把明水印给抹掉，但是暗水印不明显，用户一把没有察觉。
    查看暗水印，直接把图片放到ps里面调整亮度和对比度，根据网页背景颜色不同调整参数不同，即可看到暗水印
    imgWidthDis  imgHeightDis 默认都为50

## 1.4.0

    业务线联调测试

## 1.3.1

    添加imgWidthDis  imgHeightDis 参数

## 1.3.0

    校验是否反复初始话

## 1.2.0

    修改初始话逻辑，借鉴jq
    图片高度宽度自动获取
