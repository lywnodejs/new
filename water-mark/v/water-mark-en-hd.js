"use strict";!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof module&&module.exports?module.exports=t():e.waterMark=t()}(this,function(){function e(e){e.addEventListener("copy",function(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}),e.addEventListener("keydown",function(e){e=e||window.event;var t=e.keyCode,n=e.ctrlKey||e.metaKey;return!(!n||!e.altKey)||(n&&67==t?(E(e),!1):!n||88!=t||(E(e),!1))})}function t(){document.addEventListener("keydown",function(e){e=e||window.event;var t=e.keyCode,n=e.ctrlKey||e.metaKey;return e.altKey&&n&&~[73,74].indexOf(t)?(E(e),!1):~[123].indexOf(t)?(E(e),!1):void 0})}function n(){document.addEventListener("contextmenu",function(e){return E(e),!1})}function o(e){var t=".noselect { -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none;  user-select: none;  }",n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t)),n.appendChild(o),e.style.userSelect="none",e.className+=e.className+" noselect"}function i(i){if(!i.systemId||!i.userId||!i.timestamp)return void console.warn("必须指定： systemId userId timestamp ");if(b=!0,i.text=i.systemId+i.userId+i.timestamp,i.url=d,v=h(i.time),(i.disableSelect||i.disableSelectEl)&&(i.disableSelectEl=i.disableSelectEl||document.body,o(i.disableSelectEl)),i.disableContextMenu&&n(),i.listernerCopy&&document.addEventListener("copy",function(){var e=f()||"";y(i,"copy",{copyText:e.slice(0,l),copyTextLen:e.length})}),(i.disableCopy||i.disableCopyEl)&&(e(i.disableCopyEl||document),i.disableSelect||i.disableSelectEl||o(document.body)),c&&(x(p(i,{id:"js-wartermark",font:r.textFont,style:r.textStyle})),x(p(i,{id:"js-wartermarkhd",font:r.textFont,style:"rgba(255, 0, 0, 0.01)",containerEl:document.body,top:"30px"}))),i.disablePrint){var a,s=function(){for(var e,t=document.createDocumentFragment(),n=i.elCount;n--;)e=document.createElement("span"),e.style.cssText=i.printCssText,e.innerHTML=i.text,t.appendChild(e);var o=document.createElement("div");o.style.cssText=i.printConCssText,o.setAttribute("id","js-print-con"),o.appendChild(t),document.body.appendChild(o),a=o.outerHTML};s(),v.addMonitor(function(){var e=document.getElementById("js-print-con");e?e.outerHTML!==a&&(y(i,"modifyPrintLayer"),e.parentElement.removeChild(e),s()):(y(i,"removePrintLayer"),s())})}v.addMonitor(function(){(i.disableSelect||i.disableSelectEl)&&"none"!==i.disableSelectEl.style.userSelect&&(i.disableSelectEl.style.userSelect="none",y(i,"removeBodyUserSelect"))}).start(),window.addEventListener("resize",u(function(){(window.outerHeight-window.innerHeight>100||window.outerWidth-window.innerWidth>100)&&y(i,"openConsole")},1e3),!1);var m=window.matchMedia("print");m&&m.addListener(function(e){var t=document.getElementById("js-print-con");t&&(t.style.opacity=e.matches?1:0),e.matches?y(i,"onbeforeprint"):y(i,"onafterprint")}),i.disableGetEventListeners&&(window.getEventListeners=function(){return y(i,"getEventListeners"),{}}),i.disableOpenConsole&&(t(),i.disableContextMenu||n());var w=document.createEvent("HTMLEvents");w.initEvent("resize",!0,!0),w.eventName="resize",window.dispatchEvent(w)}var r={textStyle:"rgba(0, 0, 0, 0.15)",textFont:"24px Times New Roman",textshadowColor:"rgba(0, 0, 0, 0)",textshadowBlur:2,textRotate:30},a={systemId:"",userId:"",timestamp:"",containerEl:document.body,data:{},imgWidth:0,imgHeight:0,imgWidthDis:50,imgHeightDis:50,zIndex:1e4,time:2500,disableContextMenu:!1,disableSelect:!1,disableSelectEl:"",disableCopy:!1,disableCopyEl:"",listernerCopy:!0,disableGetEventListeners:!0,disablePrint:!0,disableOpenConsole:!1,elCount:50,printCssText:"font-size: 24px; color: transparent;line-height: 100px; width:200px;",printConCssText:"pointer-events: none; transform: rotate(30deg); display: flex; flex-wrap: wrap; flex-direction: row; width: 100%; height: 100%; top: 0; left: 0; position: fixed; z-index: 1000;"},s={removePrintLayer:"remove-print-layer",modifyPrintLayer:"modify-print-layer",removeBodyUserSelect:"remove-body-userSelect",openConsole:"open-console",onbeforeprint:"onbeforeprint",onafterprint:"onafterprint",getEventListeners:"getEventListeners",removeWaterMark:"remove-water-mark",modifyWaterMark:"modify-water-mark",copy:"copy"},d="",l=100,c=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),u=function(e,t){var n,o,i,r,a,s,d=function(){s=+new Date-r,s<t&&s>=0?n=setTimeout(d,t-s):(n=null,a=e.apply(i,o),n||(i=o=null))};return function(){return i=this,o=arguments,r=+new Date,n||(n=setTimeout(d,t)),a}},m=function(e,t,n,o,i){var r=null;r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");var e=e.toUpperCase(),a=Math.random();if("object"==typeof n){var s="";for(var d in n)s+=d+"="+n[d]+"&";n=s.replace(/&$/,"")}"GET"===e?(n?r.open("GET",t+"?"+n,!0):r.open("GET",t+"?t="+a,!0),r.send()):"POST"==e&&(r.open("POST",t,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(n)),r.onreadystatechange=function(){4===r.readyState&&(200===r.status?o&&o(r.responseText):i&&i(r.status))}},p=function(){for(var e,t={},n=Object.prototype.toString,o=arguments.length,i=0;i<o;i++)if(e=arguments[i],null!==e&&"[object Object]"===n.call(e))for(var r in e)t[r]=e[r];return t},f=function(){var e="";if("undefined"!=typeof window.getSelection){var t=window.getSelection();if(t.rangeCount){for(var n=document.createElement("div"),o=0,i=t.rangeCount;o<i;++o)n.appendChild(t.getRangeAt(o).cloneContents());e=n.innerText}}else"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(e=document.selection.createRange().htmlText);return e},y=function(e,t,n){var o,n=p({action:s[t]||"error action"},n||{});if(e.url){var i=p({currentUrl:location.href,systemId:e.systemId,userId:e.userId,timestamp:e.timestamp},n||{});o="object"==typeof e.data?p(e.data||{},i):p(i),m("POST",e.url,o)}},h=function(e){return this instanceof h?(this.monitors=[],this.timmer,this.time=e||2e3,void(this.isStop=!1)):new h(e)};h.prototype.addMonitor=function(e){return"function"==typeof e&&this.monitors.push(e),this},h.prototype.done=function(){return this.isStop?(clearTimeout(this.timmer),this):(this.monitors.forEach(function(e){e()}),this.timmer=setTimeout(this.done.bind(this),this.time),this)},h.prototype.start=function(){return this.timmer=setTimeout(this.done.bind(this),this.time),this},h.prototype.stop=function(e){return this.stop=!0,this};var v,w,g=function(e,t){var n=document.createElement("canvas"),o=n.getContext("2d");o.font=t;var i=o.measureText(e);return n=null,i.width},x=function(e){var t,n=function(e){var n=document.createElement("canvas"),o=g(e.text,r.textFont);n.width=e.imgWidth?parseInt(e.imgWidth,10):o+2-o/20+e.imgWidthDis,n.height=e.imgHeight?parseInt(e.imgHeight,10):(o+30)*Math.sin(Math.PI/6)+e.imgHeightDis,n.id=e.id;var i=n.getContext("2d");i.shadowOffsetX=2,i.shadowOffsetY=2,i.shadowBlur=r.textshadowBlur,i.shadowColor=r.textshadowColor,i.font=e.font,i.fillStyle=e.style,i.rotate(r.textRotate*Math.PI/180),i.textAlign="left",i.fillText(e.text,15,7);var a=document.createElement("div");a.id=e.id;var s="pointer-events: none;width:100%;height:100%;top:"+(e.top||0)+";left:0;position:absolute;z-index:"+e.zIndex+";";"BODY"===e.containerEl.tagName&&(s=s.replace("absolute","fixed")),a.style.cssText=s,a.style.background="url("+n.toDataURL("image/png")+") top left repeat","BODY"!==e.containerEl.tagName&&"static"===window.getComputedStyle(e.containerEl).position&&(e.containerEl.style.position="relative"),e.containerEl.appendChild(a),n=null,t=document.getElementById(e.id).outerHTML};n(e),v.addMonitor(function(){var o=document.getElementById(e.id);o?o.outerHTML!==t&&(o.remove(),n(e),y(e,"modifyWaterMark")):(n(e),y(e,"removeWaterMark"))})},E=function(e){e.preventDefault&&e.preventDefault(),e.stopImmediatePropagation&&e.stopImmediatePropagation()},b=!1,C=function(e){return e=p(a,e),w=function(){document.removeEventListener("DOMContentLoaded",w,!1),window.removeEventListener("load",w,!1),i(e)},b?(console.warn("repeat init"),"不要反复初始话"):void("complete"===document.readyState?setTimeout(function(){i(e)}):(document.addEventListener("DOMContentLoaded",w,!1),window.addEventListener("load",w,!1)))};return C.version="1.6.1",C});