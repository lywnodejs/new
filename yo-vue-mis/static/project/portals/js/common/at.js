"use strict";define("js/common/observer",["require","exports","module"],function(e,t,n){var r=function(){this.func={}},i=Array.prototype.slice;return r.prototype={constructor:r,fire:function(e){if(e){var t=i.call(arguments,1),n=this.func[e];return n&&n.length&&n.forEach(function(e){e.apply(this,t)}),this}},on:function(e,t){return void 0===t?this:((this.func[e]||(this.func[e]=[])).push(t),this)},remove:function(e,t){if(0===arguments.length)return this.func={},this;if(!this.func[e])return this;if(void 0===t)return delete this.func[e],this;var n=this.func[e].indexOf(t);return-1===n?this:(this.func[e].splice(n,1),this)},hasName:function(e){return e in this.func}},new r}),define("js/common/throttle",["require","exports","module"],function(e,t,n){return function(e,t){var n,r,i,o,l=0,c=null,a=function(){l=+new Date,c=null,i=e.apply(r,n),c||(r=n=null)};return function(){var s=+new Date;return n=arguments,r=this,o=t-(s-l),o<=0||o>t?(c&&(clearTimeout(c),c=null),l=s,i=e.apply(r,n),c||(r=n=null)):c||(c=setTimeout(a,o)),i}}}),define("js/common/utils",["require","exports","module"],function(e,t,n){var r={isDate:function(e){return"[object Date]"==={}.toString.call(e)},pageName:function(){return location.href.replace(/\.html(.+)?/,"").split("/").pop()},getUrlData:function(e){var t=(e||location.href.replace(/#.*/g,"")).match(/\?(.*)/),n={};if(!(t=t&&t[1]))return n;t=t.split("&");var r,i;return t.forEach(function(e){e=e.split("="),r=decodeURIComponent(e[0]),i="null"===e[1]||null==e[1]?"":decodeURIComponent(e[1]),r&&(n[r]=i)}),n},getHashData:function(){return r.getUrlData(location.hash)},removeScriptTags:function(e){return e&&e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<link\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/link>/gi,"")},getElOffset:function(e){if(!e)return console.log("elem is null"),{};var t=e.getBoundingClientRect(),n=document.body,r=document.documentElement;if(t.width||t.height||e.getClientRects().length){var i=window.pageYOffset||r.scrollTop||n.scrollTop,o=window.pageXOffset||r.scrollLeft||n.scrollLeft,l=r.clientTop||n.clientTop||0,c=r.clientLeft||n.clientLeft||0,a=t.top+i-l,s=t.left+o-c;return{top:Math.round(a),left:Math.round(s)}}return console.log("elem is hidde"),{}},getScroll:function(){var e=document.documentElement,t=document.body;return{left:(window.scrollX||window.pageXOffset||e.scrollLeft||t.scrollLeft)-(e.clientLeft||t.clientLeft||0),top:(window.scrollY||window.pageYOffset||e.scrollTop||t.scrollTop)-(e.clientTop||t.clientTop||0)}}};return r}),define("js/common/textarea-utils",["require","exports","module"],function(e,t,n){var r,i=i;return r={setSelectionRange:function(e,t,n){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var r=e.createTextRange();r.collapse(!0),r.moveEnd("character",n),r.moveStart("character",t),r.select()}},getCaretPosition:function(e){var t=0;if(i){e.focus();var n=i.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else"selectionStart"in e&&(t=e.selectionStart);return t},insertAtCaret:function(e,t){if(i)e.focus(),sel=i.createRange(),sel.text=t,e.focus();else if(e.selectionStart||"0"===String(e.selectionStart)){var n=e.selectionStart,r=e.selectionEnd,o=e.scrollTop;e.value=e.value.substring(0,n)+t+e.value.substring(r,e.value.length),e.focus(),e.selectionStart=n+t.length,e.selectionEnd=n+t.length,e.scrollTop=o}else e.value+=t,e.focus()},insertText:function(e,t,n,o){if(e.focus(),s=s||0,i){var l=i.createRange();l.moveStart("character",-o),l.text=t}else{var c=e.value,a=n-o,s=a+t.length;e.value=c.slice(0,a)+t+c.slice(n,c.length),r.setSelectionRange(e,s,s)}}}}),define("js/common/KEY",["require","exports","module"],function(e,t,n){var r={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,COMMAND:91,isControl:function(e){switch(e.which){case r.COMMAND:case r.SHIFT:case r.CTRL:case r.ALT:return!0}return!!(e.metaKey||e.ctrlKey||e.altKey)},isFunctionKey:function(e){return(e=e.which?e.which:e)>=112&&e<=123},isVerticalMovement:function(e){return~[r.UP,r.DOWN].indexOf(e)},isHorizontalMovement:function(e){return~[r.LEFT,r.RIGHT,r.BACKSPACE,r.DELETE].indexOf(e)}};return r}),define("js/common/at",["require","exports","module","./observer","./throttle","./utils","./textarea-utils","./KEY"],function(e,t,n){var r=e("./observer"),i=e("./throttle"),o=e("./utils"),l=window.textareaUtils=e("./textarea-utils"),c=e("./KEY"),a=(l.insertAtCaret,l.getCaretPosition),s=o.getElOffset,u="([@])([a-z/[A-Z0-9/\\]一-龥_-]{0,20})$",f=function(){var e={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":'<span style="white-space:pre-wrap;"> </span>'};return function(t){return t.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(t){return e[t]})}}();return function(e){var t=s(e),n=document.createElement("div");n.classList.add("i-textarea-tip"),n.innerHTML='<span data-type="before"></span><span data-type="flag"></span><span data-type="after"></span>',document.body.appendChild(n);var o=n.style;o.width=e.offsetWidth+"px",o.height=e.offsetHeight+"px",o.left=t.left+"px",o.top=t.top+18+"px",r.on("text-resize-height",function(e){o.height=e.height,o.overflowY=e.overflowY});var p,h=n.querySelector('[data-type="before"]'),d=n.querySelector('[data-type="flag"]'),g=n.querySelector('[data-type="after"]'),v=function(t){if("keyup"!==t.type||~[c.LEFT,c.RIGHT].indexOf(t.which)){var n=e.value.replace(/\r/g,""),i=a(e);if(!(i<=0||i===p)){p=i;var o=n.slice(0,i),l=o.match(new RegExp(u));if(!l)return void r.fire("hide-user-list");var s=n.slice(i);o=o.slice(0,-l[0].length),T(),m(o,l[1],l[2],s)}}},m=function(t,n,i,o){h.innerHTML=f(t),d.innerHTML=f(n)||"&thinsp;",g.innerHTML=f([i,o].join("")),r.fire("show-user-list",i,s(d),e)},E=function(t){e.focus();var n=e.value.replace(/\r/g,""),r=0|e.getAttribute("startPos")||a(e),i=n.slice(0,r),o=i.match(new RegExp(u)),c=o&&o[2]?o[2].length:0;l.insertText(e,t.name+" ",r,c)},T=function(){e.setAttribute("startPos",l.getCaretPosition(e))};r.on("insert-text",E);var w=i(v,200);["input","mouseup","keyup"].forEach(function(t){e.addEventListener(t,w)}),e.addEventListener("blur",function(){setTimeout(function(){r.fire("hide-user-list")},200)}),e.addEventListener("mouseup",T),window.textareaEl=e}});