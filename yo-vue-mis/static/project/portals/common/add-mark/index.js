define("js/common/debounce",["require","exports","module"],function(e,t,n){return function(e,t){var n,a,r,l,i,c,u=function(){c=+new Date-l,c<t&&c>=0?n=setTimeout(u,t-c):(n=null,i=e.apply(r,a),n||(r=a=null))};return function(){return r=this,a=arguments,l=+new Date,n||(n=setTimeout(u,t)),i}}}),define("common/add-mark/index",["require","exports","module","../../js/common/debounce"],function(e,t,n){var a=e("../../js/common/debounce");void 0===angular.element.prototype.querySelectorAll&&(angular.element.prototype.querySelectorAll=function(e){return angular.element(this[0].querySelectorAll(e))});var r={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,RIGHT:39,CTRL:17,BACKSPACE:8,DELETE:46,isHorizontalMovement:function(e){return~[r.LEFT,r.RIGHT,r.BACKSPACE,r.DELETE].indexOf(e)}},l=angular.module("ui.myAddMark",[]).constant("defaultAddMarkConfig",{placeholder:"",limit:10,maxlength:100}).directive("uisAddMarkTranscludeAppend",["$injector",function(e){return{link:function(t,n,a,r,l){e.has("uisAddMarkTranscludeAppend")||l(t,function(e){n.append(e)})}}}]);l.controller("uiMyAddMarkCtrl",["$scope","$timeout","$http","$q","$element","defaultAddMarkConfig","$window",function(e,t,n,l,i,c,u){function o(e){switch(e){case r.TAB:case r.ENTER:d.addItem()}}var d=this;d.searchVal=void 0,d.selected=[],d.placeholder=e.placeholder||c.placeholder,d.maxlength=0|e.maxlength||c.maxlength,d.inputName=e.name||"",d.limit=0|e.limit||c.limit,d.searchInputElement=angular.element(i[0].querySelector("input")),d.addItem=function(){var t=(d.searchVal||"").trim();t&&!d.hasItem(t)&&e.$broadcast("uis:add-mark",t)},d.hasItem=function(e){return d.selected.some(function(t){return angular.equals(e,t)})},d.searchInputElement.on("keydown",function(t){var n=t.which;n!==r.ENTER&&n!==r.ESC||(t.preventDefault(),t.stopPropagation()),e.$apply(function(){o(n)})});var s=null,m=!1;d.sizeSearchInput=function(){var n=d.searchInputElement[0],a=d.searchInputElement.parent().parent()[0],r=function(){return a.clientWidth*!!n.offsetParent},l=function(e){if(0===e)return!1;var t=e-n.offsetLeft-2;return t<60&&(t=e),d.searchInputElement.css("width",t+"px"),!0};d.searchInputElement.css("width","10px"),t(function(){null!==s||l(r())||(s=e.$watch(function(){m||(m=!0,e.$$postDigest(function(){m=!1,l(r())&&(s(),s=null)}))},angular.noop))})};var p=a(function(){d.sizeSearchInput()},50);angular.element(u).bind("resize",p),e.$on("$destroy",function(){d.searchInputElement.off("keyup keydown tagged blur paste")})}]),l.directive("uiMyAddMark",["$timeout","defaultAddMarkConfig","$parse","$document",function(e,t,n,a,r){return{restrict:"EA",templateUrl:function(e,t){return"/addMark/main.tpl.html"},scope:{placeholder:"@",limit:"@?",inputName:"@?",maxlength:"@?"},require:["uiMyAddMark","^ngModel"],replace:!0,transclude:!0,controllerAs:"$addMarkCtrl",controller:"uiMyAddMarkCtrl",compile:function(e,t){return e.append("<ui-selected-marks/>"),function(e,t,n,a,r){var l=(a[0],a[0]),i=a[1];l.ngModel=i,r(e,function(e){var n=angular.element("<div>").append(e),a=n.querySelectorAll(".ui-select-match");if(a.removeAttr("ui-select-match"),a.removeAttr("data-ui-select-match"),1!==a.length)throw Error("ui-select-match must be one");t.querySelectorAll(".ui-select-match").replaceWith(a)})}}}}]),l.directive("uiSelectMarkItem",["$compile","$window",function(e,t){return{restrict:"EA",require:"^uiMyAddMark",templateUrl:function(e,t){return e.addClass("ui-select-match"),"/addMark/SelectMultiple.tpl.html"},replace:!0,transclude:!0,compile:function(e,t){return function(e,t,n,a,r){a.sizeSearchInput()}}}}]),l.directive("uiSelectedMarks",["$timeout",function(e){return{restrict:"EA",require:["^uiMyAddMark","^ngModel"],controller:["$scope","$timeout",function(e,t){var n,a=this,r=e.$addMarkCtrl;angular.isUndefined(r.selected)&&(r.selected=[]),e.$evalAsync(function(){n=e.ngModel}),a.activeMatchIndex=-1,a.removeChoice=function(e){return r.selected.splice(e,1),a.activeMatchIndex=-1,r.sizeSearchInput(),!0}}],controllerAs:"$addMarksListCtrl",link:function(t,n,a,l){function i(e){return angular.isNumber(e.selectionStart)?e.selectionStart:e.value.length}function c(e){var t=i(u.searchInputElement[0]),n=u.selected.length,a=n-1,l=d.activeMatchIndex,c=d.activeMatchIndex+1,o=d.activeMatchIndex-1,s=l;return!(t>0||u.searchVal&&u.searchVal.length&&e==r.RIGHT)&&(s=function(){switch(e){case r.LEFT:return~d.activeMatchIndex?o:a;case r.RIGHT:return l===a?0:c;case r.BACKSPACE:return~d.activeMatchIndex?d.removeChoice(l)?o:l:a;case r.DELETE:return!!~d.activeMatchIndex&&(d.removeChoice(d.activeMatchIndex),l)}}(),u.selected.length&&!1!==s?d.activeMatchIndex=Math.min(a,Math.max(0,s)):d.activeMatchIndex=-1,!0)}var u=l[0],o=t.ngModel=l[1],d=t.$addMarksListCtrl;t.$on("uis:add-mark",function(e,t){var n=u.selected.length,a=0;if(!(n>=u.limit)){for(;a<n;){if(angular.equals(u.selected[a],t))return;a++}u.selected.push(t),u.searchVal="",u.sizeSearchInput()}}),u.searchInputElement.on("keydown",function(e){var n=e.which;t.$apply(function(){var t=!1;r.isHorizontalMovement(n)&&(t=c(n)),t&&n!=r.TAB&&(e.preventDefault(),e.stopPropagation())})}),u.searchInputElement.on("blur",function(){e(function(){u.activeMatchIndex=-1})}),o.$isEmpty=function(e){return!e||0===e.length},o.$render=function(){if(!angular.isArray(o.$viewValue)){if(!angular.isUndefined(o.$viewValue)&&null!==o.$viewValue)throw Error("multiarr","Expected model value to be array but got '{0}'");o.$viewValue=[]}u.selected=o.$viewValue,t.$evalAsync()},o.$formatters.unshift(function(e){return e})}}}]),angular.module("ui.myAddMark").run(["$templateCache",function(e){e.put("/addMark/main.tpl.html",'\n                            <div class="ui-select-container ui-select-multiple ui-select-bootstrap dropdown form-control direction-up">\n                                <div>\n                                    <span class="ui-select-match"></span>\n                                    <input type="search"\n                                    autocomplete="off"\n                                    class="ui-select-search\n                                    auto-pointer"\n                                    ng-disabled="disable" \n                                    placeholder="{{$addMarkCtrl.placeholder}}"\n                                    maxlength="{{$addMarkCtrl.maxlength}}"\n                                    name="{{$addMarkCtrl.inputName}}"\n                                    ng-model="$addMarkCtrl.searchVal"\n                                    >\n                                </div>\n                            </div>')}]),angular.module("ui.myAddMark").run(["$templateCache",function(e){e.put("/addMark/SelectMultiple.tpl.html",'\n                            <span class="ui-select-match" ng-show="$addMarkCtrl.selected.length">\n                                <span ng-repeat="$item in $addMarkCtrl.selected track by $index">\n                                    <span\n                                        class="ui-select-match-item btn btn-default btn-xs"\n                                        tabindex="-1"\n                                        type="button"\n                                        ng-click="$addMarksListCtrl.activeMatchIndex = $index;"\n                                        ng-class="{\'btn-primary\':$addMarksListCtrl.activeMatchIndex === $index}"\n                                    >\n                                        <span\n                                            class="close ui-select-match-close"\n                                            ng-hide="$addMarkCtrl.disabled"\n                                            ng-click="$addMarksListCtrl.removeChoice($index)"\n                                        >&nbsp;&times;</span>\n                                        <span uis-add-mark-transclude-append></span>\n                                    </span>\n                                </span>\n                            </span>')}])});