define(function(e,a,n){"use strict";var o=angular.module("ngDialog",[]),l=angular.element,t=angular.isDefined,i=(document.body||document.documentElement).style,r=t(i.animation)||t(i.WebkitAnimation)||t(i.MozAnimation)||t(i.MsAnimation)||t(i.OAnimation),s="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",c="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",d="ngdialog-disabled-animation",g={html:!1,body:!1},u={},p=[],m=!1,f=!1;return o.provider("ngDialog",function(){var e=this.defaults={className:"ngdialog-theme-default",appendClassName:"",disableAnimation:!1,plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null,bodyClassName:"ngdialog-open",width:null,height:null};this.setForceHtmlReload=function(e){g.html=e||!1},this.setForceBodyReload=function(e){g.body=e||!1},this.setDefaults=function(a){angular.extend(e,a)},this.setOpenOnePerName=function(e){f=e||!1};var a,n=0,o=0,t={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","$injector",function(i,y,b,v,h,D,C,$,A,E){var w=[],B={onDocumentKeydown:function(e){27===e.keyCode&&S.close("$escape")},activate:function(e){var a=e.data("$ngDialogOptions");a.trapFocus&&(e.on("keydown",B.onTrapFocusKeydown),w.body.on("keydown",B.onTrapFocusKeydown))},deactivate:function(e){e.off("keydown",B.onTrapFocusKeydown),w.body.off("keydown",B.onTrapFocusKeydown)},deactivateAll:function(e){angular.forEach(e,function(e){var a=angular.element(e);B.deactivate(a)})},setBodyPadding:function(e){var a=parseInt(w.body.css("padding-right")||0,10);w.body.css("padding-right",a+e+"px"),w.body.data("ng-dialog-original-padding",a),D.$broadcast("ngDialog.setPadding",e)},resetBodyPadding:function(){var e=w.body.data("ng-dialog-original-padding");e?w.body.css("padding-right",e+"px"):w.body.css("padding-right",""),D.$broadcast("ngDialog.setPadding",0)},performCloseDialog:function(e,n){var l=e.data("$ngDialogOptions"),i=e.attr("id"),c=u[i];if(c){if("undefined"!=typeof $.Hammer){var d=c.hammerTime;d.off("tap",a),d.destroy&&d.destroy(),delete c.hammerTime}else e.unbind("click");1===o&&w.body.unbind("keydown",B.onDocumentKeydown),e.hasClass("ngdialog-closing")||(o-=1);var g=e.data("$ngDialogPreviousFocus");g&&g.focus&&g.focus(),D.$broadcast("ngDialog.closing",e,n),o=0>o?0:o,r&&!l.disableAnimation?(c.$destroy(),e.unbind(s).bind(s,function(){B.closeDialogElement(e,n)}).addClass("ngdialog-closing")):(c.$destroy(),B.closeDialogElement(e,n)),t[i]&&(t[i].resolve({id:i,value:n,$dialog:e,remainingDialogs:o}),delete t[i]),u[i]&&delete u[i],p.splice(p.indexOf(i),1),p.length||(w.body.unbind("keydown",B.onDocumentKeydown),m=!1)}},closeDialogElement:function(e,a){var n=e.data("$ngDialogOptions");e.remove(),0===o&&(w.html.removeClass(n.bodyClassName),w.body.removeClass(n.bodyClassName),B.resetBodyPadding()),D.$broadcast("ngDialog.closed",e,a)},closeDialog:function(e,a){var n=e.data("$ngDialogPreCloseCallback");if(n&&angular.isFunction(n)){var o=n.call(e,a);if(angular.isObject(o))o.closePromise?o.closePromise.then(function(){B.performCloseDialog(e,a)},function(){return!1}):o.then(function(){B.performCloseDialog(e,a)},function(){return!1});else{if(o===!1)return!1;B.performCloseDialog(e,a)}}else B.performCloseDialog(e,a)},onTrapFocusKeydown:function(e){var a,n=angular.element(e.currentTarget);if(n.hasClass("ngdialog"))a=n;else if(a=B.getActiveDialog(),null===a)return;var o=9===e.keyCode,l=e.shiftKey===!0;o&&B.handleTab(a,e,l)},handleTab:function(e,a,n){var o=B.getFocusableElements(e);if(0===o.length)return void(document.activeElement&&document.activeElement.blur&&document.activeElement.blur());var l=document.activeElement,t=Array.prototype.indexOf.call(o,l),i=-1===t,r=0===t,s=t===o.length-1,c=!1;n?(i||r)&&(o[o.length-1].focus(),c=!0):(i||s)&&(o[0].focus(),c=!0),c&&(a.preventDefault(),a.stopPropagation())},autoFocus:function(e){var a=e[0],n=a.querySelector("*[autofocus]");if(null===n||(n.focus(),document.activeElement!==n)){var o=B.getFocusableElements(e);if(o.length>0)return void o[0].focus();var t=B.filterVisibleElements(a.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span"));if(t.length>0){var i=t[0];l(i).attr("tabindex","-1").css("outline","0"),i.focus()}}},getFocusableElements:function(e){var a=e[0],n=a.querySelectorAll(c),o=B.filterTabbableElements(n);return B.filterVisibleElements(o)},filterTabbableElements:function(e){for(var a=[],n=0;n<e.length;n++){var o=e[n];"-1"!==l(o).attr("tabindex")&&a.push(o)}return a},filterVisibleElements:function(e){for(var a=[],n=0;n<e.length;n++){var o=e[n];(o.offsetWidth>0||o.offsetHeight>0)&&a.push(o)}return a},getActiveDialog:function(){var e=document.querySelectorAll(".ngdialog");return 0===e.length?null:l(e[e.length-1])},applyAriaAttributes:function(e,a){if(a.ariaAuto){if(!a.ariaRole){var n=B.getFocusableElements(e).length>0?"dialog":"alertdialog";a.ariaRole=n}a.ariaLabelledBySelector||(a.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6"),a.ariaDescribedBySelector||(a.ariaDescribedBySelector="article,section,p")}a.ariaRole&&e.attr("role",a.ariaRole),B.applyAriaAttribute(e,"aria-labelledby",a.ariaLabelledById,a.ariaLabelledBySelector),B.applyAriaAttribute(e,"aria-describedby",a.ariaDescribedById,a.ariaDescribedBySelector)},applyAriaAttribute:function(e,a,n,o){if(n&&e.attr(a,n),o){var t=e.attr("id"),i=e[0].querySelector(o);if(!i)return;var r=t+"-"+a;return l(i).attr("id",r),e.attr(a,r),r}},detectUIRouter:function(){try{return angular.module("ui.router"),!0}catch(e){return!1}},getRouterLocationEventName:function(){return B.detectUIRouter()?"$stateChangeStart":"$locationChangeStart"}},S={__PRIVATE__:B,open:function(i){function r(e,a){return D.$broadcast("ngDialog.templateLoading",e),h.get(e,a||{}).then(function(a){return D.$broadcast("ngDialog.templateLoaded",e),a.data||""})}function s(e){return e?angular.isString(e)&&g.plain?e:"boolean"!=typeof g.cache||g.cache?r(e,{cache:y}):r(e,{cache:!1}):"Empty template"}var c=null;if(i=i||{},!(f&&i.name&&(c=i.name.toLowerCase().replace(/\s/g,"-")+"-dialog",this.isOpen(c)))){var g=angular.copy(e),k=++n;c=c||"ngdialog"+k,p.push(c),"undefined"!=typeof g.data&&("undefined"==typeof i.data&&(i.data={}),i.data=angular.merge(angular.copy(g.data),i.data)),angular.extend(g,i);var F;t[c]=F=v.defer();var T;u[c]=T=angular.isObject(g.scope)?g.scope.$new():D.$new();var N,P,O,I=angular.extend({},g.resolve);return angular.forEach(I,function(e,a){I[a]=angular.isString(e)?E.get(e):E.invoke(e,null,null,a)}),v.all({template:s(g.template||g.templateUrl),locals:v.all(I)}).then(function(e){var n=e.template,t=e.locals;g.showClose&&(n+='<div class="ngdialog-close"></div>');var i=g.overlay?"":" ngdialog-no-overlay";if(N=l('<div id="'+c+'" class="ngdialog'+i+'"></div>'),N.html(g.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content" role="document">'+n+"</div>":'<div class="ngdialog-content" role="document">'+n+"</div>"),N.data("$ngDialogOptions",g),T.ngDialogId=c,g.data&&angular.isString(g.data)){var r=g.data.replace(/^\s*/,"")[0];T.ngDialogData="{"===r||"["===r?angular.fromJson(g.data):new String(g.data),T.ngDialogData.ngDialogId=c}else g.data&&angular.isObject(g.data)&&(T.ngDialogData=g.data,T.ngDialogData.ngDialogId=c);if(g.className&&N.addClass(g.className),g.appendClassName&&N.addClass(g.appendClassName),g.width&&(O=N[0].querySelector(".ngdialog-content"),angular.isString(g.width)?O.style.width=g.width:O.style.width=g.width+"px"),g.height&&(O=N[0].querySelector(".ngdialog-content"),angular.isString(g.height)?O.style.height=g.height:O.style.height=g.height+"px"),g.disableAnimation&&N.addClass(d),P=g.appendTo&&angular.isString(g.appendTo)?angular.element(document.querySelector(g.appendTo)):w.body,B.applyAriaAttributes(N,g),g.preCloseCallback){var s;angular.isFunction(g.preCloseCallback)?s=g.preCloseCallback:angular.isString(g.preCloseCallback)&&T&&(angular.isFunction(T[g.preCloseCallback])?s=T[g.preCloseCallback]:T.$parent&&angular.isFunction(T.$parent[g.preCloseCallback])?s=T.$parent[g.preCloseCallback]:D&&angular.isFunction(D[g.preCloseCallback])&&(s=D[g.preCloseCallback])),s&&N.data("$ngDialogPreCloseCallback",s)}if(T.closeThisDialog=function(e){B.closeDialog(N,e)},g.controller&&(angular.isString(g.controller)||angular.isArray(g.controller)||angular.isFunction(g.controller))){var u;g.controllerAs&&angular.isString(g.controllerAs)&&(u=g.controllerAs);var p=A(g.controller,angular.extend(t,{$scope:T,$element:N}),!0,u);g.bindToController&&angular.extend(p.instance,{ngDialogId:T.ngDialogId,ngDialogData:T.ngDialogData,closeThisDialog:T.closeThisDialog,confirm:T.confirm}),"function"==typeof p?N.data("$ngDialogControllerController",p()):N.data("$ngDialogControllerController",p)}if(C(function(){var e=document.querySelectorAll(".ngdialog");B.deactivateAll(e),b(N)(T);var a=$.innerWidth-w.body.prop("clientWidth");w.html.addClass(g.bodyClassName),w.body.addClass(g.bodyClassName);var n=a-($.innerWidth-w.body.prop("clientWidth"));n>0&&B.setBodyPadding(n),P.append(N),B.activate(N),g.trapFocus&&B.autoFocus(N),g.name?D.$broadcast("ngDialog.opened",{dialog:N,name:g.name}):D.$broadcast("ngDialog.opened",N)}),m||(w.body.bind("keydown",B.onDocumentKeydown),m=!0),g.closeByNavigation){var f=B.getRouterLocationEventName();D.$on(f,function(e){B.closeDialog(N)===!1&&e.preventDefault()})}if(g.preserveFocus&&N.data("$ngDialogPreviousFocus",document.activeElement),a=function(e){var a=g.closeByDocument?l(e.target).hasClass("ngdialog-overlay"):!1,n=l(e.target).hasClass("ngdialog-close");(a||n)&&S.close(N.attr("id"),n?"$closeButton":"$document")},"undefined"!=typeof $.Hammer){var y=T.hammerTime=$.Hammer(N[0]);y.on("tap",a)}else N.bind("click",a);return o+=1,S}),{id:c,closePromise:F.promise,close:function(e){B.closeDialog(N,e)}}}},openConfirm:function(a){var n=v.defer(),o=angular.copy(e);a=a||{},"undefined"!=typeof o.data&&("undefined"==typeof a.data&&(a.data={}),a.data=angular.merge(angular.copy(o.data),a.data)),angular.extend(o,a),o.scope=angular.isObject(o.scope)?o.scope.$new():D.$new(),o.scope.confirm=function(e){n.resolve(e);var a=l(document.getElementById(t.id));B.performCloseDialog(a,e)};var t=S.open(o);return t?(t.closePromise.then(function(e){return e?n.reject(e.value):n.reject()}),n.promise):void 0},isOpen:function(e){var a=l(document.getElementById(e));return a.length>0},close:function(e,a){var n=l(document.getElementById(e));if(n.length)B.closeDialog(n,a);else if("$escape"===e){var o=p[p.length-1];n=l(document.getElementById(o)),n.data("$ngDialogOptions").closeByEscape&&B.closeDialog(n,"$escape")}else S.closeAll(a);return S},closeAll:function(e){for(var a=document.querySelectorAll(".ngdialog"),n=a.length-1;n>=0;n--){var o=a[n];B.closeDialog(l(o),e)}},getOpenDialogs:function(){return p},getDefaults:function(){return e}};return angular.forEach(["html","body"],function(e){if(w[e]=i.find(e),g[e]){var a=B.getRouterLocationEventName();D.$on(a,function(){w[e]=i.find(e)})}}),S}]}),o.directive("ngDialog",["ngDialog",function(e){return{restrict:"A",scope:{ngDialogScope:"="},link:function(a,n,o){n.on("click",function(n){n.preventDefault();var l=angular.isDefined(a.ngDialogScope)?a.ngDialogScope:"noScope";angular.isDefined(o.ngDialogClosePrevious)&&e.close(o.ngDialogClosePrevious);var t=e.getDefaults();e.open({template:o.ngDialog,className:o.ngDialogClass||t.className,appendClassName:o.ngDialogAppendClass,controller:o.ngDialogController,controllerAs:o.ngDialogControllerAs,bindToController:o.ngDialogBindToController,disableAnimation:o.ngDialogDisableAnimation,scope:l,data:o.ngDialogData,showClose:"false"===o.ngDialogShowClose?!1:"true"===o.ngDialogShowClose?!0:t.showClose,closeByDocument:"false"===o.ngDialogCloseByDocument?!1:"true"===o.ngDialogCloseByDocument?!0:t.closeByDocument,closeByEscape:"false"===o.ngDialogCloseByEscape?!1:"true"===o.ngDialogCloseByEscape?!0:t.closeByEscape,overlay:"false"===o.ngDialogOverlay?!1:"true"===o.ngDialogOverlay?!0:t.overlay,preCloseCallback:o.ngDialogPreCloseCallback||t.preCloseCallback,bodyClassName:o.ngDialogBodyClass||t.bodyClassName})})}}}]),o});