{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from 'react';\nimport { useCookies } from 'react-cookie';\nimport { Layout } from '~/components/Layout';\nimport api from '~/api/collection';\nimport apiProduct from '~/api/product';\nimport Search from '~/components/pages/collection/inspection/Search';\nimport TableList from '~/components/pages/collection/inspection/TableList';\nvar breadcrumbs = [{\n  text: '贷后管理'\n}, {\n  text: '贷后检查管理'\n}, {\n  text: '检查结果列表'\n}];\nvar initData = {\n  list: [],\n  totalSize: 0\n};\n\nvar getData = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(pageParams) {\n    var searchParams,\n        tenantId,\n        _yield$api$getCheckCa,\n        _yield$api$getCheckCa2,\n        data,\n        code,\n        _args = arguments;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            searchParams = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n            tenantId = _args.length > 2 ? _args[2] : undefined;\n            _context.prev = 2;\n            _context.next = 5;\n            return api.getCheckCaseList(_objectSpread(_objectSpread(_objectSpread({}, pageParams), searchParams), {}, {\n              tenantId: tenantId\n            }));\n\n          case 5:\n            _yield$api$getCheckCa = _context.sent;\n            _yield$api$getCheckCa2 = _yield$api$getCheckCa.data;\n            data = _yield$api$getCheckCa2.data;\n            code = _yield$api$getCheckCa2.code;\n            return _context.abrupt(\"return\", code == 0 ? data : initData);\n\n          case 12:\n            _context.prev = 12;\n            _context.t0 = _context[\"catch\"](2);\n            console.error(_context.t0);\n            return _context.abrupt(\"return\", initData);\n\n          case 16:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[2, 12]]);\n  }));\n\n  return function getData(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nfunction body(props) {\n  var _useState = useState([]),\n      productList = _useState[0],\n      setProductList = _useState[1];\n\n  var _useState2 = useState(_objectSpread({}, initData)),\n      data = _useState2[0],\n      setData = _useState2[1];\n\n  var _useState3 = useState({\n    page: 1,\n    pageSize: 10\n  }),\n      pageParams = _useState3[0],\n      setPageParams = _useState3[1];\n\n  var _useState4 = useState(),\n      searchParams = _useState4[0],\n      setSearchParams = _useState4[1];\n\n  var _useCookies = useCookies(['tenantId']),\n      _useCookies2 = _slicedToArray(_useCookies, 1),\n      cookies = _useCookies2[0];\n\n  var _useState5 = useState([]),\n      selectedRowKeys = _useState5[0],\n      setSelectedRowKeys = _useState5[1];\n\n  useEffect(function () {\n    getProductList();\n    getList(pageParams);\n  }, []);\n\n  var getList = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(pageParams) {\n      var searchParams,\n          data,\n          _args2 = arguments;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              searchParams = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : searchParams;\n              _context2.next = 3;\n              return getData(pageParams, searchParams, cookies.tenantId);\n\n            case 3:\n              data = _context2.sent;\n              setData(_objectSpread({}, data));\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function getList(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var getProductList = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var _yield$apiProduct$get, _yield$apiProduct$get2, _data, code;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _context3.next = 3;\n              return apiProduct.get_products({\n                tenantId: cookies.tenantId\n              });\n\n            case 3:\n              _yield$apiProduct$get = _context3.sent;\n              _yield$apiProduct$get2 = _yield$apiProduct$get.data;\n              _data = _yield$apiProduct$get2.data;\n              code = _yield$apiProduct$get2.code;\n\n              if (code == 0) {\n                setProductList(_data);\n              }\n\n              _context3.next = 13;\n              break;\n\n            case 10:\n              _context3.prev = 10;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error(_context3.t0);\n\n            case 13:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 10]]);\n    }));\n\n    return function getProductList() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var onSearch = function onSearch(values) {\n    setSearchParams(values);\n    pageParams.page = 1;\n    setPageParams(_objectSpread({}, pageParams));\n    getList(pageParams, values);\n  };\n\n  var changeList = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(pageParams) {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              setPageParams(_objectSpread({}, pageParams));\n              getList(pageParams, searchParams);\n\n            case 2:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function changeList(_x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(Layout, {\n    breadcrumbs: breadcrumbs\n  }, __jsx(Search, {\n    search: onSearch,\n    collectionLevels: props.collectionLevels,\n    productList: productList\n  }), __jsx(TableList, {\n    selectedRowKeys: selectedRowKeys,\n    setSelectedRowKeys: setSelectedRowKeys,\n    data: data,\n    pageParams: pageParams,\n    changeList: changeList,\n    collectionProducts: props.collectionProducts\n  }));\n}\n\nbody.getInitialProps = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n  var backData, _yield$Promise$all, _yield$Promise$all2, _yield$Promise$all2$, data, code, _yield$Promise$all2$2, collectionLevels, levelCode;\n\n  return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          backData = {\n            collectionProducts: [],\n            collectionLevels: []\n          };\n          _context5.prev = 1;\n          _context5.next = 4;\n          return Promise.all([api.get_data_dict('COLLECTION_PRODUCT'), api.get_data_dict('COLLECTION_LEVEL')]);\n\n        case 4:\n          _yield$Promise$all = _context5.sent;\n          _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 2);\n          _yield$Promise$all2$ = _yield$Promise$all2[0].data;\n          data = _yield$Promise$all2$.data;\n          code = _yield$Promise$all2$.code;\n          _yield$Promise$all2$2 = _yield$Promise$all2[1].data;\n          collectionLevels = _yield$Promise$all2$2.data;\n          levelCode = _yield$Promise$all2$2.code;\n\n          if (!(code == 0)) {\n            _context5.next = 14;\n            break;\n          }\n\n          return _context5.abrupt(\"return\", {\n            collectionProducts: data,\n            collectionLevels: levelCode === 0 ? collectionLevels : []\n          });\n\n        case 14:\n          backData.code = code;\n          return _context5.abrupt(\"return\", backData);\n\n        case 18:\n          _context5.prev = 18;\n          _context5.t0 = _context5[\"catch\"](1);\n          console.log(_context5.t0);\n          return _context5.abrupt(\"return\", backData);\n\n        case 22:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _callee5, null, [[1, 18]]);\n}));\nexport default body;","map":null,"metadata":{},"sourceType":"module"}