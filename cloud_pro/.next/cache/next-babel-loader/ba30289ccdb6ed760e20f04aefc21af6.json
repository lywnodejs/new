{"ast":null,"code":"import \"antd/lib/space/style\";\nimport _Space from \"antd/lib/space\";\nimport \"antd/lib/radio/style\";\nimport _Radio from \"antd/lib/radio\";\nimport \"antd/lib/upload/style\";\nimport _Upload from \"antd/lib/upload\";\nimport \"antd/lib/select/style\";\nimport _Select from \"antd/lib/select\";\nimport \"antd/lib/card/style\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Layout } from '~/components/Layout';\nimport Router, { withRouter, useRouter } from 'next/router';\nimport React, { useState, useEffect } from 'react';\nimport styles from './index.less';\nimport TableList from './TableList';\nimport api from '~/api/dataUpdate';\nimport { constant, values } from 'lodash';\nimport { base64ToFileOrBlob } from 'web-downloadfile';\nimport { postForm, post } from '~/utils/fetch';\nimport { ExclamationCircleFilled } from '@ant-design/icons';\nvar breadcrumbs = [{\n  text: '乡村振兴'\n}, {\n  text: '数据更新'\n}];\nvar pageParams = {\n  pageNum: 1,\n  pageSize: 20\n};\nvar fileTypeList = [{\n  id: 11,\n  name: '人工调整信用分'\n}, {\n  id: 12,\n  name: '医保数据'\n}, {\n  id: 13,\n  name: '劳动力数据'\n}, {\n  id: 14,\n  name: '存款数据'\n}, {\n  id: 15,\n  name: '不良贷款数据'\n}, {\n  id: 16,\n  name: '存量贷款数据'\n}, {\n  id: 17,\n  name: '线下搜集数据'\n}];\nvar fileVertical = [{\n  id: 1,\n  name: '增量 (追加新数据，覆盖重复数据)'\n}, {\n  id: 2,\n  name: '全量 (请慎重选择，此方式将删除所有同类别旧数据)'\n}];\n\nfunction body(props) {\n  _s();\n\n  //获取个人数据上传记录\n  var _useState = useState([]),\n      list = _useState[0],\n      setList = _useState[1];\n\n  var _useState2 = useState([]),\n      totalData = _useState2[0],\n      setTotalData = _useState2[1];\n\n  var _useState3 = useState(false),\n      isModalVisible = _useState3[0],\n      setIsModalVisible = _useState3[1];\n\n  var _useState4 = useState([]),\n      fileList = _useState4[0],\n      setFileList = _useState4[1];\n\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  var _useState5 = useState(false),\n      loading = _useState5[0],\n      setLoading = _useState5[1];\n\n  var router = useRouter();\n\n  var _useState6 = useState(false),\n      onModalVisible = _useState6[0],\n      setOnModalVisible = _useState6[1];\n\n  var _useState7 = useState({}),\n      valuesForm = _useState7[0],\n      setValueForm = _useState7[1];\n\n  var _useState8 = useState({}),\n      valuesTestFile = _useState8[0],\n      setValuesTestFile = _useState8[1];\n\n  var _useState9 = useState(11),\n      fileTypeId = _useState9[0],\n      setFileTypeId = _useState9[1];\n\n  var _useState10 = useState(11),\n      fileTemplate = _useState10[0],\n      setFileTemplate = _useState10[1];\n\n  var showModal = function showModal() {\n    setIsModalVisible(true);\n  };\n\n  useEffect(function () {\n    fetchList(); // onSearch()\n    // onRescore()\n  }, []); //下载模板\n\n  var onDownLoad = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _yield$api$fetch_down, _yield$api$fetch_down2, data, code, linkElement;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return api.fetch_downloadTemplate_list({});\n\n            case 3:\n              _yield$api$fetch_down = _context.sent;\n              _yield$api$fetch_down2 = _yield$api$fetch_down.data;\n              data = _yield$api$fetch_down2.data;\n              code = _yield$api$fetch_down2.code;\n\n              if (code == 0) {\n                linkElement = document.createElement('a');\n                linkElement.style.display = 'none';\n                linkElement.href = data;\n                document.body.appendChild(linkElement);\n                linkElement.click();\n                document.body.removeChild(linkElement);\n                console.log(data);\n                base64ToFileOrBlob('data:wKgc4WDMQI6AOn16AAC22lK3WwU732/zip;base64,' + data.pdfData);\n              }\n\n              _context.next = 13;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](0);\n              console.log(_context.t0);\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 10]]);\n    }));\n\n    return function onDownLoad() {\n      return _ref.apply(this, arguments);\n    };\n  }(); //获取个人数据上传记录\n\n\n  var fetchList = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var values,\n          _yield$api$fetch_uplo,\n          _yield$api$fetch_uplo2,\n          data,\n          code,\n          _args2 = arguments;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              values = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : {};\n              _context2.prev = 1;\n              _context2.next = 4;\n              return api.fetch_uploadRecord_list(_objectSpread(_objectSpread({}, pageParams), values));\n\n            case 4:\n              _yield$api$fetch_uplo = _context2.sent;\n              _yield$api$fetch_uplo2 = _yield$api$fetch_uplo.data;\n              data = _yield$api$fetch_uplo2.data;\n              code = _yield$api$fetch_uplo2.code;\n\n              if (code === 0) {\n                data.list.forEach(function (item) {\n                  item.uploadSuccNum = item.uploadSuccNum || '-';\n                  item.uploadFailNum = item.uploadFailNum || '-';\n                  item.scoreSuccNum = item.scoreSuccNum || '-';\n                  item.scoreFailNum = item.scoreFailNum || '-';\n                });\n                setList(data.list);\n                setTotalData(data);\n              }\n\n              _context2.next = 14;\n              break;\n\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](1);\n              console.log(_context2.t0);\n\n            case 14:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 11]]);\n    }));\n\n    return function fetchList() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onBeforeUpload = function onBeforeUpload() {\n    return false;\n  };\n\n  var onChangeUpload = function onChangeUpload(info) {\n    var files = _toConsumableArray(info.fileList);\n\n    files = files.slice(-1);\n    setFileList(files);\n  };\n\n  var onCancel = function onCancel() {\n    form.resetFields();\n    setFileList([]);\n    setIsModalVisible(false);\n  };\n\n  var onUpload = function onUpload(values) {\n    console.log(values);\n    values.testFile = values.testFile.file;\n\n    if (isMac()) {\n      var fileType = values.testFile.name.endsWith('.xlsx') || values.testFile.name.endsWith('.xls');\n\n      if (!fileType) {\n        _message.warning('只能上传excel文件！请重新选择');\n\n        return;\n      }\n    }\n\n    setValueForm(values);\n    setValuesTestFile(values.testFile);\n    setOnModalVisible(true);\n  };\n\n  var onConfirmUpload = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var _yield$postForm, code;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              setLoading(true);\n              _context3.prev = 1;\n              _context3.next = 4;\n              return postForm('core/rural/upload', valuesForm);\n\n            case 4:\n              _yield$postForm = _context3.sent;\n              code = _yield$postForm.data.code;\n\n              if (code === 0) {\n                onCancel();\n              }\n\n              _context3.next = 12;\n              break;\n\n            case 9:\n              _context3.prev = 9;\n              _context3.t0 = _context3[\"catch\"](1);\n              console.log(_context3.t0);\n\n            case 12:\n              setOnModalVisible(false);\n              setLoading(false);\n\n            case 14:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[1, 9]]);\n    }));\n\n    return function onConfirmUpload() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var isMac = function isMac() {\n    if (typeof navigator !== 'undefined') {\n      return /macintosh|mac os x/i.test(navigator.userAgent);\n    }\n\n    return false;\n  };\n\n  var onSearch = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(value) {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              pageParams.pageNum = 1;\n              fetchList(_objectSpread({}, values));\n\n            case 2:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function onSearch(_x) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var onPage = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              fetchList(values);\n\n            case 1:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function onPage() {\n      return _ref5.apply(this, arguments);\n    };\n  }(); //重新评分\n\n\n  var onFail = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(record) {\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              console.log(record);\n\n              _Modal.confirm({\n                title: '下载失败的数据',\n                onOk: function onOk() {\n                  return new Promise(function (resolve, reject) {\n                    post('core/rural/rescore', {\n                      recordId: record.uploadFailNum\n                    }).then(function (_ref7) {\n                      var _ref7$data = _ref7.data,\n                          data = _ref7$data.data,\n                          code = _ref7$data.code;\n\n                      if (code === 0) {\n                        var linkElement = document.createElement('a');\n                        linkElement.style.display = 'none';\n                        linkElement.href = 'https://test-oss.xysl.com/group1/M00/01/68/wKgc4WDRjCGAMYJaAABoALb4cjY950.xls';\n                        document.body.appendChild(linkElement);\n                        linkElement.click();\n                        document.body.removeChild(linkElement);\n                        console.log(data);\n                        resolve();\n\n                        _message.success('下载成功');\n\n                        console.log(record.uploadFailNum);\n                      }\n\n                      reject();\n                    });\n                  })[\"catch\"](function () {\n                    return console.log('Oops errors!');\n                  });\n                }\n              });\n\n            case 2:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }));\n\n    return function onFail(_x2) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n\n  var onScore = /*#__PURE__*/function () {\n    var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(record) {\n      return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              console.log(record);\n\n              _Modal.confirm({\n                title: '确定重新评分？',\n                onOk: function onOk() {\n                  return new Promise(function (resolve, reject) {\n                    post('core/rural/rescore', {\n                      recordId: record.id\n                    }).then(function (_ref9) {\n                      var _ref9$data = _ref9.data,\n                          data = _ref9$data.data,\n                          code = _ref9$data.code;\n\n                      if (code === 0) {\n                        resolve();\n\n                        _message.success('提交成功');\n                      }\n\n                      reject();\n                    });\n                  })[\"catch\"](function () {\n                    return console.log('Oops errors!');\n                  });\n                }\n              });\n\n            case 2:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7);\n    }));\n\n    return function onScore(_x3) {\n      return _ref8.apply(this, arguments);\n    };\n  }();\n\n  var getFileTypeList = function getFileTypeList() {\n    var a = fileTypeList.find(function (item) {\n      return item.id === valuesForm.fileType;\n    });\n\n    if (a) {\n      return a.name;\n    }\n  };\n\n  var getHandleType = function getHandleType() {\n    var a = fileVertical.find(function (item) {\n      return item.id === valuesForm.handleType;\n    });\n\n    if (a) {\n      return a.name;\n    }\n  };\n\n  var fileTypeChange = function fileTypeChange(val) {\n    setFileTypeId(val);\n    setFileTemplate(val);\n  };\n\n  return __jsx(React.Fragment, null, __jsx(Layout, {\n    breadcrumbs: breadcrumbs\n  }, __jsx(_Card, {\n    style: {\n      marginBottom: 30\n    }\n  }, __jsx(_Form, null, __jsx(_Button, {\n    type: \"primary\",\n    style: {\n      width: 120,\n      borderRadius: 5\n    },\n    onClick: showModal\n  }, \"\\u5BFC\\u5165\\u6570\\u636E\"), __jsx(\"u\", {\n    className: styles.item,\n    id: \"a\",\n    onClick: onDownLoad\n  }, \"\\u4E0B\\u8F7D\\u6A21\\u677F\"))), __jsx(TableList, {\n    list: list,\n    setList: setList,\n    totalData: totalData,\n    pageParams: pageParams,\n    onPage: onPage,\n    onSearch: onSearch,\n    values: values,\n    onScore: onScore,\n    onFail: onFail\n  })), __jsx(_Space, {\n    direction: \"vertical\",\n    size: \"large\",\n    style: {\n      width: '100%'\n    }\n  }, __jsx(_Form, {\n    layout: \"inline\",\n    className: \"searchForm\",\n    initialValues: {\n      fileType: '',\n      testFile: '',\n      handleType: '',\n      name: '0'\n    },\n    form: form,\n    onFinish: onUpload\n  }, __jsx(_Modal, {\n    title: \"\\u5BFC\\u5165\\u6570\\u636E\",\n    visible: isModalVisible,\n    onOk: function onOk() {\n      form.submit();\n    },\n    okText: \"\\u7EE7\\u7EED\",\n    onCancel: onCancel\n  }, __jsx(\"div\", {\n    style: {\n      display: 'flex'\n    }\n  }, __jsx(_Form.Item, {\n    label: \"\\u6570\\u636E\\u7C7B\\u522B\",\n    name: \"name\",\n    rules: [{\n      required: true\n    }]\n  }, __jsx(_Select, {\n    style: {\n      width: '130px'\n    }\n  }, __jsx(_Select.Option, {\n    value: \"0\"\n  }, \"\\u4E2A\\u4EBA\"))), __jsx(_Form.Item, {\n    name: \"fileType\",\n    rules: [{\n      required: true,\n      message: '请选择数据类别'\n    }]\n  }, __jsx(_Select, {\n    style: {\n      width: '130px',\n      marginLeft: '10px'\n    },\n    onChange: function onChange(val) {\n      return fileTypeChange(val);\n    }\n  }, __jsx(_Select.Option, {\n    value: \"\"\n  }, \"\\u8BF7\\u9009\\u62E9\"), fileTypeList.map(function (item) {\n    return __jsx(_Select.Option, {\n      value: item.id,\n      key: item.id\n    }, item.name);\n  })))), __jsx(_Form.Item, {\n    label: \"\\u6570\\u636E\\u6587\\u4EF6\",\n    name: \"testFile\",\n    rules: [{\n      required: true,\n      message: '请上传文件'\n    }]\n  }, __jsx(_Upload, {\n    beforeUpload: onBeforeUpload,\n    onChange: onChangeUpload,\n    showUploadList: {\n      showRemoveIcon: false\n    },\n    fileList: fileList,\n    accept: isMac() ? '' : 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel'\n  }, __jsx(_Button, {\n    style: {\n      width: '130px'\n    }\n  }, \"\\u4E0A\\u4F20\\u6587\\u4EF6\"))), fileTypeId !== 11 && __jsx(_Form.Item, {\n    label: \"\\u5BFC\\u5165\\u6A21\\u5F0F\",\n    name: \"handleType\",\n    rules: [{\n      required: true,\n      message: '请选择导入模式'\n    }]\n  }, __jsx(_Radio.Group, null, __jsx(_Space, {\n    direction: \"vertical\"\n  }, fileVertical.map(function (item) {\n    return __jsx(_Radio, {\n      value: item.id,\n      key: item.id\n    }, item.name);\n  })))))), __jsx(_Modal, {\n    visible: onModalVisible,\n    onOk: onConfirmUpload,\n    onCancel: function onCancel() {\n      setOnModalVisible(false);\n    },\n    closeIcon: true,\n    confirmLoading: loading\n  }, __jsx(\"div\", {\n    style: {\n      display: 'flex'\n    }\n  }, __jsx(ExclamationCircleFilled, {\n    style: {\n      color: 'rgb(250, 173, 20)',\n      fontSize: '24px'\n    }\n  }), __jsx(\"p\", {\n    style: {\n      marginLeft: '10px',\n      fontSize: '16px'\n    }\n  }, \"\\u8BF7\\u786E\\u8BA4\\u4EE5\\u4E0B\\u4FE1\\u606F\")), __jsx(\"div\", null, __jsx(\"div\", {\n    className: styles.upData\n  }, __jsx(\"span\", null, \"\\u6570\\u636E\\u7C7B\\u522B:\"), __jsx(\"span\", null, \"\\u4E2A\\u4EBA-\", getFileTypeList())), __jsx(\"div\", {\n    className: styles.upData\n  }, __jsx(\"span\", null, \"\\u6570\\u636E\\u6587\\u4EF6:\"), __jsx(\"span\", null, valuesTestFile.name)), fileTemplate !== 11 && __jsx(\"div\", {\n    className: styles.upData\n  }, __jsx(\"span\", null, \"\\u5BFC\\u5165\\u6A21\\u5F0F:\"), __jsx(\"span\", null, getHandleType()))))));\n}\n\n_s(body, \"bMpN9SFwQwZjBaWFVTtUGM3dfzs=\", false, function () {\n  return [_Form.useForm, useRouter];\n});\n\nbody.getInitialProps = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n  return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          return _context8.abrupt(\"return\", {});\n\n        case 1:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _callee8);\n}));\nexport default body;","map":{"version":3,"sources":["/Users/liuyawei/Desktop/信用算力/项目/cloud_pro/pages/vitalization/dataUpdate/index.js"],"names":["Layout","Router","withRouter","useRouter","React","useState","useEffect","styles","TableList","api","constant","values","base64ToFileOrBlob","postForm","post","ExclamationCircleFilled","breadcrumbs","text","pageParams","pageNum","pageSize","fileTypeList","id","name","fileVertical","body","props","list","setList","totalData","setTotalData","isModalVisible","setIsModalVisible","fileList","setFileList","useForm","form","loading","setLoading","router","onModalVisible","setOnModalVisible","valuesForm","setValueForm","valuesTestFile","setValuesTestFile","fileTypeId","setFileTypeId","fileTemplate","setFileTemplate","showModal","fetchList","onDownLoad","fetch_downloadTemplate_list","data","code","linkElement","document","createElement","style","display","href","appendChild","click","removeChild","console","log","pdfData","fetch_uploadRecord_list","forEach","item","uploadSuccNum","uploadFailNum","scoreSuccNum","scoreFailNum","onBeforeUpload","onChangeUpload","info","files","slice","onCancel","resetFields","onUpload","testFile","file","isMac","fileType","endsWith","warning","onConfirmUpload","navigator","test","userAgent","onSearch","value","onPage","onFail","record","confirm","title","onOk","Promise","resolve","reject","recordId","then","success","onScore","getFileTypeList","a","find","getHandleType","handleType","fileTypeChange","val","marginBottom","width","borderRadius","submit","required","message","marginLeft","map","showRemoveIcon","color","fontSize","upData","getInitialProps"],"mappings":"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","sourcesContent":["import {Layout} from '~/components/Layout'\nimport Router, {withRouter, useRouter} from 'next/router'\nimport React, {useState, useEffect} from 'react'\nimport {\n  Radio,\n  Space,\n  Form,\n  Button,\n  Card,\n  Modal,\n  Select,\n  Upload,\n  message,\n} from 'antd'\nimport styles from './index.less'\nimport TableList from './TableList'\nimport api from '~/api/dataUpdate'\nimport {constant, values} from 'lodash'\nimport {base64ToFileOrBlob} from 'web-downloadfile'\nimport {postForm, post} from '~/utils/fetch'\nimport {ExclamationCircleFilled} from '@ant-design/icons'\n\nconst breadcrumbs = [{text: '乡村振兴'}, {text: '数据更新'}]\n\nconst pageParams = {\n  pageNum: 1,\n  pageSize: 20,\n}\nconst fileTypeList = [\n  {id: 11, name: '人工调整信用分'},\n  {id: 12, name: '医保数据'},\n  {id: 13, name: '劳动力数据'},\n  {id: 14, name: '存款数据'},\n  {id: 15, name: '不良贷款数据'},\n  {id: 16, name: '存量贷款数据'},\n  {id: 17, name: '线下搜集数据'},\n]\nconst fileVertical = [\n  {id: 1, name: '增量 (追加新数据，覆盖重复数据)'},\n  {id: 2, name: '全量 (请慎重选择，此方式将删除所有同类别旧数据)'},\n]\nfunction body(props) {\n  //获取个人数据上传记录\n  const [list, setList] = useState([])\n  const [totalData, setTotalData] = useState([])\n  const [isModalVisible, setIsModalVisible] = useState(false)\n  const [fileList, setFileList] = useState([])\n  const [form] = Form.useForm()\n  const [loading, setLoading] = useState(false)\n  const router = useRouter()\n  const [onModalVisible, setOnModalVisible] = useState(false)\n  const [valuesForm, setValueForm] = useState({})\n  const [valuesTestFile, setValuesTestFile] = useState({})\n  const [fileTypeId, setFileTypeId] = useState(11)\n  const [fileTemplate, setFileTemplate] = useState(11)\n  const showModal = () => {\n    setIsModalVisible(true)\n  }\n\n  useEffect(() => {\n    fetchList()\n\n    // onSearch()\n    // onRescore()\n  }, [])\n\n  //下载模板\n  const onDownLoad = async () => {\n    try {\n      const {\n        data: {data, code},\n      } = await api.fetch_downloadTemplate_list({})\n      if (code == 0) {\n        const linkElement = document.createElement('a')\n        linkElement.style.display = 'none'\n        linkElement.href = data\n        document.body.appendChild(linkElement)\n        linkElement.click()\n        document.body.removeChild(linkElement)\n        console.log(data)\n        base64ToFileOrBlob(\n          'data:wKgc4WDMQI6AOn16AAC22lK3WwU732/zip;base64,' + data.pdfData,\n        )\n      }\n    } catch (err) {\n      console.log(err)\n    }\n  }\n\n  //获取个人数据上传记录\n  const fetchList = async (values = {}) => {\n    try {\n      const {\n        data: {data, code},\n      } = await api.fetch_uploadRecord_list({\n        ...pageParams,\n        ...values,\n      })\n      if (code === 0) {\n        data.list.forEach((item) => {\n          item.uploadSuccNum = item.uploadSuccNum || '-'\n          item.uploadFailNum = item.uploadFailNum || '-'\n          item.scoreSuccNum = item.scoreSuccNum || '-'\n          item.scoreFailNum = item.scoreFailNum || '-'\n        })\n        setList(data.list)\n        setTotalData(data)\n      }\n    } catch (err) {\n      console.log(err)\n    }\n  }\n\n  const onBeforeUpload = () => {\n    return false\n  }\n\n  const onChangeUpload = (info) => {\n    let files = [...info.fileList]\n    files = files.slice(-1)\n    setFileList(files)\n  }\n\n  const onCancel = () => {\n    form.resetFields()\n    setFileList([])\n    setIsModalVisible(false)\n  }\n\n  const onUpload = (values) => {\n    console.log(values)\n\n    values.testFile = values.testFile.file\n\n    if (isMac()) {\n      const fileType =\n        values.testFile.name.endsWith('.xlsx') ||\n        values.testFile.name.endsWith('.xls')\n      if (!fileType) {\n        message.warning('只能上传excel文件！请重新选择')\n        return\n      }\n    }\n\n    setValueForm(values)\n    setValuesTestFile(values.testFile)\n    setOnModalVisible(true)\n  }\n\n  const onConfirmUpload = async () => {\n    setLoading(true)\n    try {\n      const {\n        data: {code},\n      } = await postForm('core/rural/upload', valuesForm)\n      if (code === 0) {\n        onCancel()\n      }\n    } catch (e) {\n      console.log(e)\n    }\n    setOnModalVisible(false)\n    setLoading(false)\n  }\n\n  const isMac = () => {\n    if (typeof navigator !== 'undefined') {\n      return /macintosh|mac os x/i.test(navigator.userAgent)\n    }\n    return false\n  }\n\n  const onSearch = async (value) => {\n    pageParams.pageNum = 1\n    fetchList({...values})\n  }\n\n  const onPage = async () => {\n    fetchList(values)\n  }\n\n  //重新评分\n  const onFail = async (record) => {\n    console.log(record)\n    Modal.confirm({\n      title: '下载失败的数据',\n      onOk() {\n        return new Promise((resolve, reject) => {\n          post('core/rural/rescore', {recordId: record.uploadFailNum}).then(\n            ({data: {data, code}}) => {\n              if (code === 0) {\n                const linkElement = document.createElement('a')\n                linkElement.style.display = 'none'\n                linkElement.href =\n                  'https://test-oss.xysl.com/group1/M00/01/68/wKgc4WDRjCGAMYJaAABoALb4cjY950.xls'\n                document.body.appendChild(linkElement)\n                linkElement.click()\n                document.body.removeChild(linkElement)\n                console.log(data)\n\n                resolve()\n                message.success('下载成功')\n                console.log(record.uploadFailNum)\n              }\n              reject()\n            },\n          )\n        }).catch(() => console.log('Oops errors!'))\n      },\n    })\n  }\n\n  const onScore = async (record) => {\n    console.log(record)\n    Modal.confirm({\n      title: '确定重新评分？',\n      onOk() {\n        return new Promise((resolve, reject) => {\n          post('core/rural/rescore', {recordId: record.id}).then(\n            ({data: {data, code}}) => {\n              if (code === 0) {\n                resolve()\n                message.success('提交成功')\n              }\n              reject()\n            },\n          )\n        }).catch(() => console.log('Oops errors!'))\n      },\n    })\n  }\n\n  const getFileTypeList = () => {\n    let a = fileTypeList.find((item) => item.id === valuesForm.fileType)\n    if (a) {\n      return a.name\n    }\n  }\n  const getHandleType = () => {\n    let a = fileVertical.find((item) => item.id === valuesForm.handleType)\n    if (a) {\n      return a.name\n    }\n  }\n  const fileTypeChange = (val) => {\n    setFileTypeId(val)\n    setFileTemplate(val)\n  }\n\n  return (\n    <>\n      <Layout breadcrumbs={breadcrumbs}>\n        <Card style={{marginBottom: 30}}>\n          <Form>\n            <Button\n              type=\"primary\"\n              style={{width: 120, borderRadius: 5}}\n              onClick={showModal}\n            >\n              导入数据\n            </Button>\n            <u className={styles.item} id=\"a\" onClick={onDownLoad}>\n              下载模板\n            </u>\n          </Form>\n        </Card>\n\n        <TableList\n          {...{\n            list,\n            setList,\n            totalData,\n            pageParams,\n            onPage,\n            onSearch,\n            values,\n            onScore,\n            onFail,\n          }}\n        />\n      </Layout>\n\n      <Space direction=\"vertical\" size=\"large\" style={{width: '100%'}}>\n        <Form\n          layout=\"inline\"\n          className=\"searchForm\"\n          initialValues={{\n            fileType: '',\n            testFile: '',\n            handleType: '',\n            name: '0',\n          }}\n          form={form}\n          onFinish={onUpload}\n        >\n          <Modal\n            title=\"导入数据\"\n            visible={isModalVisible}\n            onOk={() => {\n              form.submit()\n            }}\n            okText=\"继续\"\n            onCancel={onCancel}\n          >\n            <div style={{display: 'flex'}}>\n              <Form.Item\n                label=\"数据类别\"\n                name=\"name\"\n                rules={[{required: true}]}\n              >\n                <Select style={{width: '130px'}}>\n                  <Select.Option value=\"0\">个人</Select.Option>\n                </Select>\n              </Form.Item>\n              <Form.Item\n                name=\"fileType\"\n                rules={[{required: true, message: '请选择数据类别'}]}\n              >\n                <Select\n                  style={{width: '130px', marginLeft: '10px'}}\n                  onChange={(val) => fileTypeChange(val)}\n                >\n                  <Select.Option value=\"\">请选择</Select.Option>\n                  {fileTypeList.map((item) => {\n                    return (\n                      <Select.Option value={item.id} key={item.id}>\n                        {item.name}\n                      </Select.Option>\n                    )\n                  })}\n                </Select>\n              </Form.Item>\n            </div>\n            <Form.Item\n              label=\"数据文件\"\n              name=\"testFile\"\n              rules={[{required: true, message: '请上传文件'}]}\n            >\n              <Upload\n                beforeUpload={onBeforeUpload}\n                onChange={onChangeUpload}\n                showUploadList={{showRemoveIcon: false}}\n                fileList={fileList}\n                accept={\n                  isMac()\n                    ? ''\n                    : 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel'\n                }\n              >\n                <Button style={{width: '130px'}}>上传文件</Button>\n              </Upload>\n            </Form.Item>\n            {fileTypeId !== 11 && (\n              <Form.Item\n                label=\"导入模式\"\n                name=\"handleType\"\n                rules={[{required: true, message: '请选择导入模式'}]}\n              >\n                <Radio.Group>\n                  <Space direction=\"vertical\">\n                    {fileVertical.map((item) => {\n                      return (\n                        <Radio value={item.id} key={item.id}>\n                          {item.name}\n                        </Radio>\n                      )\n                    })}\n                  </Space>\n                </Radio.Group>\n              </Form.Item>\n            )}\n          </Modal>\n        </Form>\n\n        <Modal\n          visible={onModalVisible}\n          onOk={onConfirmUpload}\n          onCancel={() => {\n            setOnModalVisible(false)\n          }}\n          closeIcon\n          confirmLoading={loading}\n        >\n          <div style={{display: 'flex'}}>\n            <ExclamationCircleFilled\n              style={{color: 'rgb(250, 173, 20)', fontSize: '24px'}}\n            />\n            <p style={{marginLeft: '10px', fontSize: '16px'}}>请确认以下信息</p>\n          </div>\n          <div>\n            <div className={styles.upData}>\n              <span>数据类别:</span>\n              <span>\n                个人-\n                {getFileTypeList()}\n              </span>\n            </div>\n            <div className={styles.upData}>\n              <span>数据文件:</span>\n              <span>{valuesTestFile.name}</span>\n            </div>\n            {fileTemplate !== 11 && (\n              <div className={styles.upData}>\n                <span>导入模式:</span>\n                <span>{getHandleType()}</span>\n              </div>\n            )}\n          </div>\n        </Modal>\n      </Space>\n    </>\n  )\n}\n\nbody.getInitialProps = async () => {\n  return {}\n}\n\nexport default body\n"]},"metadata":{},"sourceType":"module"}