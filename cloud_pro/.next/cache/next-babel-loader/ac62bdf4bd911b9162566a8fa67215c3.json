{"ast":null,"code":"import \"antd/lib/alert/style\";\nimport _Alert from \"antd/lib/alert\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from 'react';\nimport { useCookies } from 'react-cookie';\nimport { Layout } from '~/components/Layout';\nimport api from '~/api/collection';\nimport apiProduct from '~/api/product';\nimport Search from '~/components/pages/collection/distribution/Search';\nimport TableList from '~/components/pages/collection/distribution/TableList'; // import BatchedAssignModal from '~/components/common/BatchedAssignModal'\n// import AssignModal from '~/components/common/AssignModal'\n\nimport AssignModal from '~/components/common/collection/AssignModal';\nimport BatchedAssignModal from '~/components/common/collection/BatchedAssignModal';\nvar breadcrumbs = [{\n  text: '贷后管理'\n}, {\n  text: '催收管理'\n}, {\n  text: '分配列表'\n}];\nvar initData = {\n  list: [],\n  total: 0\n};\n\nvar getData = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(pageParams) {\n    var searchParams,\n        orderBys,\n        tenantId,\n        _yield$api$fetch_over,\n        _yield$api$fetch_over2,\n        data,\n        code,\n        _args = arguments;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            searchParams = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n            orderBys = _args.length > 2 && _args[2] !== undefined ? _args[2] : null;\n            tenantId = _args.length > 3 ? _args[3] : undefined;\n            _context.prev = 3;\n            _context.next = 6;\n            return api.fetch_overdueAlloc_list(_objectSpread(_objectSpread(_objectSpread({}, pageParams), searchParams), {}, {\n              orderBys: orderBys,\n              tenantId: tenantId\n            }));\n\n          case 6:\n            _yield$api$fetch_over = _context.sent;\n            _yield$api$fetch_over2 = _yield$api$fetch_over.data;\n            data = _yield$api$fetch_over2.data;\n            code = _yield$api$fetch_over2.code;\n            return _context.abrupt(\"return\", code == 0 ? data : initData);\n\n          case 13:\n            _context.prev = 13;\n            _context.t0 = _context[\"catch\"](3);\n            console.error(_context.t0);\n            return _context.abrupt(\"return\", initData);\n\n          case 17:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[3, 13]]);\n  }));\n\n  return function getData(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar getUserData = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    var _yield$api$getNewTree, _yield$api$getNewTree2, data, code;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return api.getNewTreeMemberList();\n\n          case 3:\n            _yield$api$getNewTree = _context2.sent;\n            _yield$api$getNewTree2 = _yield$api$getNewTree.data;\n            data = _yield$api$getNewTree2.data;\n            code = _yield$api$getNewTree2.code;\n            return _context2.abrupt(\"return\", code == 0 ? data : []);\n\n          case 10:\n            _context2.prev = 10;\n            _context2.t0 = _context2[\"catch\"](0);\n            console.error(_context2.t0);\n            return _context2.abrupt(\"return\", []);\n\n          case 14:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[0, 10]]);\n  }));\n\n  return function getUserData() {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nfunction body(props) {\n  var _useState = useState([]),\n      productList = _useState[0],\n      setProductList = _useState[1];\n\n  var _useState2 = useState(_objectSpread({}, initData)),\n      data = _useState2[0],\n      setData = _useState2[1];\n\n  var _useState3 = useState({\n    page: 1,\n    pageSize: 20\n  }),\n      pageParams = _useState3[0],\n      setPageParams = _useState3[1];\n\n  var _useState4 = useState(),\n      searchParams = _useState4[0],\n      setSearchParams = _useState4[1];\n\n  var _useState5 = useState(),\n      orderBys = _useState5[0],\n      setOrderBys = _useState5[1];\n\n  var _useState6 = useState(false),\n      visible = _useState6[0],\n      setVisible = _useState6[1];\n\n  var _useState7 = useState(false),\n      batchedVisible = _useState7[0],\n      setBatchedVisible = _useState7[1];\n\n  var _useState8 = useState(0),\n      total = _useState8[0],\n      setTotal = _useState8[1];\n\n  var _useCookies = useCookies(['tenantId']),\n      _useCookies2 = _slicedToArray(_useCookies, 1),\n      cookies = _useCookies2[0];\n\n  var _useState9 = useState([]),\n      selectedRowKeys = _useState9[0],\n      setSelectedRowKeys = _useState9[1];\n\n  useEffect(function () {\n    getProductList();\n    getList(pageParams);\n    console.log(props);\n  }, []);\n\n  var getList = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(pageParams) {\n      var searchParams,\n          orderBys,\n          data,\n          _args3 = arguments;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              searchParams = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : searchParams;\n              orderBys = _args3.length > 2 && _args3[2] !== undefined ? _args3[2] : orderBys;\n              _context3.next = 4;\n              return getData(pageParams, searchParams, orderBys, cookies.tenantId);\n\n            case 4:\n              data = _context3.sent;\n              setSelectedRowKeys([]);\n              setData(_objectSpread({}, data));\n\n            case 7:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function getList(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var getProductList = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var _yield$apiProduct$get, _yield$apiProduct$get2, _data, code;\n\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return apiProduct.get_products({\n                tenantId: cookies.tenantId\n              });\n\n            case 3:\n              _yield$apiProduct$get = _context4.sent;\n              _yield$apiProduct$get2 = _yield$apiProduct$get.data;\n              _data = _yield$apiProduct$get2.data;\n              code = _yield$apiProduct$get2.code;\n\n              if (code == 0) {\n                setProductList(_data);\n              }\n\n              _context4.next = 13;\n              break;\n\n            case 10:\n              _context4.prev = 10;\n              _context4.t0 = _context4[\"catch\"](0);\n              console.error(_context4.t0);\n\n            case 13:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 10]]);\n    }));\n\n    return function getProductList() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var onSearch = function onSearch(values) {\n    setSearchParams(values);\n    pageParams.page = 1;\n    setPageParams(_objectSpread({}, pageParams));\n    getList(pageParams, values, orderBys);\n  };\n\n  var onSearchTotal = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(values) {\n      var _yield$api$fetch_over3, _yield$api$fetch_over4, _data2, code;\n\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              values.beginCreateTime = null;\n              values.endCreateTime = null;\n              values.beginGrantTime = null;\n              values.endGrantTime = null;\n              _context5.next = 7;\n              return api.fetch_overdueAlloc_list(_objectSpread(_objectSpread({}, values), {}, {\n                page: 1,\n                pageSize: 10000,\n                orderBys: null,\n                tenantId: cookies.tenantId\n              }));\n\n            case 7:\n              _yield$api$fetch_over3 = _context5.sent;\n              _yield$api$fetch_over4 = _yield$api$fetch_over3.data;\n              _data2 = _yield$api$fetch_over4.data;\n              code = _yield$api$fetch_over4.code;\n\n              if (code === 0) {\n                setTotal(_data2.total);\n              }\n\n              _context5.next = 17;\n              break;\n\n            case 14:\n              _context5.prev = 14;\n              _context5.t0 = _context5[\"catch\"](0);\n              console.log(_context5.t0);\n\n            case 17:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[0, 14]]);\n    }));\n\n    return function onSearchTotal(_x3) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var changeList = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(pageParams, orderBys) {\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              setPageParams(_objectSpread({}, pageParams));\n              setOrderBys(orderBys);\n              getList(pageParams, searchParams, orderBys);\n\n            case 3:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }));\n\n    return function changeList(_x4, _x5) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n\n  var changeVisible = function changeVisible() {\n    if (!selectedRowKeys.length) {\n      return _message.error('请先选择要分配的订单');\n    }\n\n    setVisible(true);\n  };\n\n  var onAssign = function onAssign(_ref7, onError) {\n    var params = _extends({}, _ref7);\n\n    params.collectionOrderIdList = selectedRowKeys;\n    params.tenantId = cookies.tenantId;\n    commitAssign(params, setVisible, onError);\n  };\n\n  var onBatchedAssign = function onBatchedAssign(_ref8, onError) {\n    var params = _extends({}, _ref8);\n\n    params.tenantId = cookies.tenantId;\n    commitAssign(params, setBatchedVisible, onError);\n  };\n\n  var commitAssign = function commitAssign(params, onSuccess, onError) {\n    api.edit_overdueAlloc_allselect(params).then(function (_ref9) {\n      var code = _ref9.data.code;\n\n      if (code == 0) {\n        _message.success('分配成功');\n\n        getList(pageParams);\n        setTotal(0);\n        onSuccess(false);\n      } else {\n        onError();\n      }\n    })[\"catch\"](function (err) {\n      onError();\n    });\n  };\n\n  var getShowTips = function getShowTips() {\n    var total = 0;\n\n    if (selectedRowKeys.length > 0) {\n      total = selectedRowKeys.reduce(function (prev, next) {\n        var item = data.list.find(function (v) {\n          return v.id == next;\n        });\n        var amount = item && item.totalCapitalAmount || 0;\n        return amount + prev;\n      }, total);\n      total = total.toFixed(2);\n    }\n\n    return \"\\u5DF2\\u9009\\u62E9 \".concat(selectedRowKeys.length, \" \\u9879\\u3002   \\u5F53\\u524D\\u67E5\\u8BE2\\u903E\\u671F\\u603B\\u672C\\u91D1\\u4E4B\\u548C\").concat(total);\n  };\n\n  return __jsx(Layout, {\n    breadcrumbs: breadcrumbs\n  }, __jsx(Search, {\n    search: onSearch,\n    setBatchedVisible: setBatchedVisible,\n    changeVisible: changeVisible,\n    collectionLevels: props.collectionLevels,\n    productList: productList\n  }), __jsx(_Alert, {\n    message: getShowTips(),\n    style: {\n      marginBottom: 15\n    },\n    type: \"info\",\n    showIcon: true\n  }), __jsx(TableList, {\n    selectedRowKeys: selectedRowKeys,\n    setSelectedRowKeys: setSelectedRowKeys,\n    data: data,\n    pageParams: pageParams,\n    changeList: changeList,\n    collectionProducts: props.collectionProducts\n  }), __jsx(AssignModal, {\n    showNumber: selectedRowKeys.length,\n    visible: visible,\n    onHide: function onHide() {\n      return setVisible(false);\n    },\n    onOk: onAssign,\n    showList: props.userList\n  }), __jsx(BatchedAssignModal, {\n    onSearch: onSearchTotal,\n    total: total,\n    visible: batchedVisible,\n    onHide: function onHide() {\n      return setBatchedVisible(false);\n    },\n    productList: productList,\n    collectionLevels: props.collectionLevels,\n    showList: props.userList,\n    onOk: onBatchedAssign\n  }));\n}\n\nbody.getInitialProps = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n  var userList, backData, _yield$Promise$all, _yield$Promise$all2, _yield$Promise$all2$, data, code, _yield$Promise$all2$2, collectionLevels, levelCode;\n\n  return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 2;\n          return getUserData();\n\n        case 2:\n          userList = _context7.sent;\n          backData = {\n            collectionProducts: [],\n            collectionLevels: [],\n            userList: userList\n          };\n          _context7.prev = 4;\n          _context7.next = 7;\n          return Promise.all([api.get_data_dict('COLLECTION_PRODUCT'), api.get_data_dict('COLLECTION_LEVEL')]);\n\n        case 7:\n          _yield$Promise$all = _context7.sent;\n          _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 2);\n          _yield$Promise$all2$ = _yield$Promise$all2[0].data;\n          data = _yield$Promise$all2$.data;\n          code = _yield$Promise$all2$.code;\n          _yield$Promise$all2$2 = _yield$Promise$all2[1].data;\n          collectionLevels = _yield$Promise$all2$2.data;\n          levelCode = _yield$Promise$all2$2.code;\n\n          if (!(code == 0)) {\n            _context7.next = 17;\n            break;\n          }\n\n          return _context7.abrupt(\"return\", {\n            collectionProducts: data,\n            collectionLevels: levelCode === 0 ? collectionLevels : [],\n            userList: userList\n          });\n\n        case 17:\n          backData.code = code;\n          return _context7.abrupt(\"return\", backData);\n\n        case 21:\n          _context7.prev = 21;\n          _context7.t0 = _context7[\"catch\"](4);\n          console.log(_context7.t0);\n          return _context7.abrupt(\"return\", backData);\n\n        case 25:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _callee7, null, [[4, 21]]);\n}));\nexport default body;","map":null,"metadata":{},"sourceType":"module"}