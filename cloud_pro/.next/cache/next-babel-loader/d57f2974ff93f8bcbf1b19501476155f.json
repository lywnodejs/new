{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/config-provider/style\";\nimport _ConfigProvider from \"antd/lib/config-provider\";\n\nvar _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React from 'react';\nimport axios from 'axios';\nimport zhCN from 'antd/lib/locale/zh_CN';\nimport api from '~/api/product';\nimport { cookies } from '~/utils';\nimport '~/themes/index.less';\nimport { CommonLayout } from '~/components/Layout/Layout';\nimport Login from '~/pages/login';\nimport { KeepAliveProvider } from 'react-next-keep-alive';\nimport { useRouter } from 'next/router';\nexport var Context = React.createContext();\n\nvar Main = function Main(_ref) {\n  _s();\n\n  var statusCode = _ref.statusCode,\n      Component = _ref.Component,\n      pageProps = _ref.pageProps;\n  var router = useRouter();\n\n  if (pageProps.login || pageProps.isError) {\n    return __jsx(Component, pageProps);\n  }\n\n  return __jsx(CommonLayout, null, __jsx(KeepAliveProvider, {\n    router: router\n  }, __jsx(Component, pageProps)));\n};\n\n_s(Main, \"fN7XvhJ+p5oE6+Xlo0NJmXpxjC8=\", false, function () {\n  return [useRouter];\n});\n\n_c = Main;\n\nfunction App(_ref2) {\n  var Component = _ref2.Component,\n      pageProps = _ref2.pageProps,\n      statusCode = _ref2.statusCode,\n      isServer = _ref2.isServer,\n      menu = _ref2.menu;\n  return __jsx(_ConfigProvider, {\n    locale: zhCN\n  }, __jsx(Context.Provider, {\n    value: {\n      menu: menu\n    }\n  }, __jsx(Main, {\n    Component: Component,\n    pageProps: pageProps,\n    statusCode: statusCode,\n    isServer: isServer\n  })));\n}\n\n_c2 = App;\n\nApp.getInitialProps = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(appContext) {\n    var statusCode, isServer, cookie, _cookies, sessionId, pageProps, menu, _yield$api$get_menu_l, _yield$api$get_menu_l2, code, data;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            statusCode = 0;\n            isServer = appContext.ctx.req !== undefined;\n\n            if (isServer) {\n              axios.defaults.baseURL = \"\".concat(appContext.ctx.req.protocol, \"://\").concat(appContext.ctx.req.headers.host);\n\n              if (appContext.ctx.req.headers && appContext.ctx.req.headers.cookie) {\n                // console.log('server:', appContext.ctx.req.headers.cookie)\n                cookie = appContext.ctx.req.headers.cookie.replace('sessionId=undefined;', '');\n                _cookies = cookies(cookie), sessionId = _cookies.sessionId;\n                delete axios.defaults.headers.common['token'];\n\n                if (sessionId !== undefined && sessionId !== 'undefined') {\n                  axios.defaults.headers.common['token'] = sessionId;\n                }\n              }\n            }\n\n            pageProps = {}; // let {menu} = await import('~/lib/menu')\n\n            menu = [];\n            _context.prev = 5;\n            _context.next = 8;\n            return api.get_menu_list();\n\n          case 8:\n            _yield$api$get_menu_l = _context.sent;\n            _yield$api$get_menu_l2 = _yield$api$get_menu_l.data;\n            code = _yield$api$get_menu_l2.code;\n            data = _yield$api$get_menu_l2.data;\n\n            // console.log(code, data)\n            if (code == 0 && Array.isArray(data)) {\n              menu = data;\n            }\n\n            statusCode = code;\n            _context.next = 21;\n            break;\n\n          case 16:\n            _context.prev = 16;\n            _context.t0 = _context[\"catch\"](5);\n            console.log(_context.t0);\n            menu = [];\n\n            if (isServer && !appContext.ctx.req.originalUrl.startsWith('/error')) {\n              appContext.ctx.res.writeHead(307, {\n                Location: '/error?statusCode=500'\n              });\n              appContext.ctx.res.end();\n            }\n\n          case 21:\n            if (!appContext.Component.getInitialProps) {\n              _context.next = 26;\n              break;\n            }\n\n            _context.next = 24;\n            return appContext.Component.getInitialProps(appContext);\n\n          case 24:\n            pageProps = _context.sent;\n            statusCode = pageProps.code;\n\n          case 26:\n            if (isServer && (statusCode === -8 || statusCode === 1) && !pageProps.isError) {\n              // console.log(pageProps)\n              if (appContext.ctx.req.originalUrl !== '/login') {\n                appContext.ctx.res.writeHead(307, {\n                  Location: '/login'\n                });\n                appContext.ctx.res.end();\n              }\n            }\n\n            return _context.abrupt(\"return\", {\n              pageProps: pageProps,\n              menu: menu,\n              statusCode: statusCode\n            });\n\n          case 28:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[5, 16]]);\n  }));\n\n  return function (_x) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nexport default App;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Main\");\n$RefreshReg$(_c2, \"App\");","map":{"version":3,"sources":["/Users/liuyawei/Desktop/rxhui/信用算力/项目/cloud_pro/pages/_app.js"],"names":["React","axios","zhCN","api","cookies","CommonLayout","Login","KeepAliveProvider","useRouter","Context","createContext","Main","statusCode","Component","pageProps","router","login","isError","App","isServer","menu","getInitialProps","appContext","ctx","req","undefined","defaults","baseURL","protocol","headers","host","cookie","replace","sessionId","common","get_menu_list","data","code","Array","isArray","console","log","originalUrl","startsWith","res","writeHead","Location","end"],"mappings":"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","sourcesContent":["import React from 'react'\nimport axios from 'axios'\nimport {ConfigProvider} from 'antd'\nimport zhCN from 'antd/lib/locale/zh_CN'\nimport api from '~/api/product'\nimport {cookies} from '~/utils'\nimport '~/themes/index.less'\nimport {CommonLayout} from '~/components/Layout/Layout'\nimport Login from '~/pages/login'\nimport {KeepAliveProvider} from 'react-next-keep-alive'\nimport {useRouter} from 'next/router'\n\nexport const Context = React.createContext()\n\nconst Main = ({statusCode, Component, pageProps}) => {\n  const router = useRouter()\n  if (pageProps.login || pageProps.isError) {\n    return <Component {...pageProps} />\n  }\n\n  return (\n    <CommonLayout>\n      <KeepAliveProvider router={router}>\n        <Component {...pageProps} />\n      </KeepAliveProvider>\n    </CommonLayout>\n  )\n}\n\nfunction App({Component, pageProps, statusCode, isServer, menu}) {\n  return (\n    <ConfigProvider locale={zhCN}>\n      <Context.Provider value={{menu}}>\n        <Main {...{Component, pageProps, statusCode, isServer}} />\n      </Context.Provider>\n    </ConfigProvider>\n  )\n}\n\nApp.getInitialProps = async (appContext) => {\n  let statusCode = 0\n  const isServer = appContext.ctx.req !== undefined\n\n  if (isServer) {\n    axios.defaults.baseURL = `${appContext.ctx.req.protocol}://${appContext.ctx.req.headers.host}`\n\n    if (appContext.ctx.req.headers && appContext.ctx.req.headers.cookie) {\n      // console.log('server:', appContext.ctx.req.headers.cookie)\n      const cookie = appContext.ctx.req.headers.cookie.replace(\n        'sessionId=undefined;',\n        '',\n      )\n\n      const {sessionId} = cookies(cookie)\n\n      delete axios.defaults.headers.common['token']\n\n      if (sessionId !== undefined && sessionId !== 'undefined') {\n        axios.defaults.headers.common['token'] = sessionId\n      }\n    }\n  }\n\n  let pageProps = {}\n  // let {menu} = await import('~/lib/menu')\n  let menu = []\n  try {\n    // throw new Error({msg: 'test'})\n    const {\n      data: {code, data},\n    } = await api.get_menu_list()\n    // console.log(code, data)\n    if (code == 0 && Array.isArray(data)) {\n      menu = data\n    }\n    statusCode = code\n  } catch (e) {\n    console.log(e)\n    menu = []\n\n    if (isServer && !appContext.ctx.req.originalUrl.startsWith('/error')) {\n      appContext.ctx.res.writeHead(307, {Location: '/error?statusCode=500'})\n      appContext.ctx.res.end()\n    }\n  }\n\n  if (appContext.Component.getInitialProps) {\n    pageProps = await appContext.Component.getInitialProps(appContext)\n    statusCode = pageProps.code\n  }\n\n  if (\n    isServer &&\n    (statusCode === -8 || statusCode === 1) &&\n    !pageProps.isError\n  ) {\n    // console.log(pageProps)\n    if (appContext.ctx.req.originalUrl !== '/login') {\n      appContext.ctx.res.writeHead(307, {Location: '/login'})\n      appContext.ctx.res.end()\n    }\n  }\n\n  return {\n    pageProps,\n    menu,\n    statusCode,\n  }\n}\n\nexport default App\n"]},"metadata":{},"sourceType":"module"}