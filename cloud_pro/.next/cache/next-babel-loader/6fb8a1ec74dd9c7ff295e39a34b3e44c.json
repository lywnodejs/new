{"ast":null,"code":"import \"antd/lib/card/style\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/select/style\";\nimport _Select from \"antd/lib/select\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/date-picker/style\";\nimport _DatePicker from \"antd/lib/date-picker\";\nvar __jsx = React.createElement;\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React, { useEffect, useState } from 'react';\nconst {\n  RangePicker\n} = _DatePicker;\nimport apiRegulatory from '~/api/regulatory';\nimport { SECOND_REPORT_TYPE, SECOND_REPORT_MSG_TYPE } from '~/utils/const';\nimport moment from 'moment';\nexport default function (props) {\n  const [form] = _Form.useForm();\n\n  useEffect(() => {\n    let firstDay = moment(moment().format('YYYY-MM') + '-01');\n    let openTime = [firstDay, moment()];\n    form.setFieldsValue({\n      openTime,\n      reportTime: [moment(), moment()]\n    });\n    onSearch();\n  }, []);\n\n  const onSearch = () => {\n    let _form$getFieldsValue = form.getFieldsValue(),\n        {\n      openTime,\n      reportTime\n    } = _form$getFieldsValue,\n        params = _objectWithoutProperties(_form$getFieldsValue, [\"openTime\", \"reportTime\"]);\n\n    if (Array.isArray(openTime) && openTime.length == 2) {\n      params.startCreateAccountDate = moment(openTime[0]).format('YYYY-MM-DD');\n      params.endCreateAccountDate = moment(openTime[1]).format('YYYY-MM-DD');\n    }\n\n    if (Array.isArray(reportTime) && reportTime.length == 2) {\n      params.startNeedReportDate = moment(reportTime[0]).format('YYYY-MM-DD');\n      params.endNeedReportDate = moment(reportTime[1]).format('YYYY-MM-DD');\n    }\n\n    props.search(params);\n  };\n\n  const resetForm = () => {\n    form.resetFields();\n    onSearch();\n  };\n\n  const exportData = async () => {\n    let {\n      reportTime\n    } = form.getFieldsValue();\n    const params = {};\n\n    if (Array.isArray(reportTime) && reportTime.length == 2) {\n      params.startNeedReportDate = moment(reportTime[0]).format('YYYY-MM-DD');\n      params.endNeedReportDate = moment(reportTime[1]).format('YYYY-MM-DD');\n      let {\n        data: {\n          code,\n          data\n        }\n      } = await apiRegulatory.exportSecondReportList(params);\n\n      if (code == 0) {\n        getFileAndDownload(data.fileName, data.fileBase64);\n      }\n    } else {\n      _message.error('请选择上报日期');\n    }\n  };\n\n  const getFileAndDownload = (fileName, url) => {\n    var x = new XMLHttpRequest();\n    x.open('GET', url, true);\n    x.responseType = 'blob';\n\n    x.onload = function (e) {\n      var blob = x.response;\n\n      if ('msSaveOrOpenBlob' in navigator) {\n        //IE导出\n        window.navigator.msSaveOrOpenBlob(blob, fileName);\n      } else {\n        var a = document.createElement('a');\n        a.download = fileName;\n        a.href = URL.createObjectURL(blob);\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n      }\n    };\n\n    x.send();\n  };\n\n  return __jsx(_Card, {\n    style: {\n      marginBottom: 30\n    }\n  }, __jsx(_Form, {\n    form: form,\n    name: \"search\",\n    initialValues: {\n      status: null,\n      catId: null\n    },\n    layout: \"inline\"\n  }, __jsx(_Form.Item, {\n    label: \"\\u5B58\\u6B3E\\u4EBA\\u59D3\\u540D\",\n    name: \"name\"\n  }, __jsx(_Input, {\n    placeholder: \"\\u5B58\\u6B3E\\u4EBA\\u59D3\\u540D\",\n    style: {\n      width: 150\n    }\n  })), __jsx(_Form.Item, {\n    label: \"\\u624B\\u673A\\u53F7\",\n    name: \"mobilePhone\"\n  }, __jsx(_Input, {\n    placeholder: \"\\u624B\\u673A\\u53F7\",\n    style: {\n      width: 150\n    }\n  })), __jsx(_Form.Item, {\n    label: \"\\u5B58\\u6B3E\\u4EBA\\u8EAB\\u4EFD\\u8BC1\\u4EF6\\u53F7\\u7801\",\n    name: \"idCard\"\n  }, __jsx(_Input, {\n    placeholder: \"\\u5B58\\u6B3E\\u4EBA\\u8EAB\\u4EFD\\u8BC1\\u4EF6\\u53F7\\u7801\",\n    style: {\n      width: 150\n    }\n  })), __jsx(_Form.Item, {\n    label: \"\\u8D26\\u53F7\",\n    name: \"cardNo\"\n  }, __jsx(_Input, {\n    placeholder: \"\\u8D26\\u53F7\",\n    style: {\n      width: 150\n    }\n  })), __jsx(_Form.Item, {\n    label: \"\\u4FE1\\u606F\\u7C7B\\u578B\",\n    name: \"catId\"\n  }, __jsx(_Select, {\n    style: {\n      width: 150\n    }\n  }, __jsx(_Select.Option, {\n    value: null\n  }, \"\\u5168\\u90E8\"), props.allCategory.map((v, i) => {\n    return __jsx(_Select.Option, {\n      value: v.id + '',\n      key: i\n    }, v.name);\n  }))), __jsx(_Form.Item, {\n    label: \"\\u4E0A\\u62A5\\u72B6\\u6001\",\n    name: \"status\"\n  }, __jsx(_Select, {\n    style: {\n      width: 120\n    }\n  }, __jsx(_Select.Option, {\n    value: null\n  }, \"\\u5168\\u90E8\"), SECOND_REPORT_TYPE.map((v, i) => {\n    return __jsx(_Select.Option, {\n      value: v.key,\n      key: i\n    }, v.name);\n  }))), __jsx(_Form.Item, {\n    label: \"\\u5F00\\u6237\\u65E5\\u671F\",\n    name: \"openTime\"\n  }, __jsx(RangePicker, null)), __jsx(_Form.Item, {\n    label: \"\\u5E94\\u4E0A\\u62A5\\u65E5\\u671F\",\n    name: \"reportTime\"\n  }, __jsx(RangePicker, null)), __jsx(_Form.Item, null, __jsx(_Button, {\n    type: \"primary\",\n    onClick: onSearch\n  }, \"\\u67E5\\u8BE2\")), __jsx(_Form.Item, null, __jsx(_Button, {\n    onClick: resetForm\n  }, \"\\u91CD\\u7F6E\")), __jsx(_Form.Item, null, __jsx(_Button, {\n    type: \"primary\",\n    onClick: exportData\n  }, \"\\u5BFC\\u51FA\\u4E0A\\u62A5\\u6587\\u4EF6\"))));\n}","map":null,"metadata":{},"sourceType":"module"}