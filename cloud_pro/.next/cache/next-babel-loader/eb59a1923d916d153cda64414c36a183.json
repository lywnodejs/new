{"ast":null,"code":"import \"antd/lib/card/style\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/select/style\";\nimport _Select from \"antd/lib/select\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport \"antd/lib/date-picker/style\";\nimport _DatePicker from \"antd/lib/date-picker\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nvar RangePicker = _DatePicker.RangePicker;\nimport apiRegulatory from '~/api/regulatory';\nimport { SECOND_REPORT_TYPE, SECOND_REPORT_MSG_TYPE } from '~/utils/const';\nimport moment from 'moment';\nexport default function (props) {\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  useEffect(function () {\n    var firstDay = moment(moment().format('YYYY-MM') + '-01');\n    var openTime = [firstDay, moment()];\n    form.setFieldsValue({\n      openTime: openTime,\n      reportTime: [moment(), moment()]\n    });\n    onSearch();\n  }, []);\n\n  var onSearch = function onSearch() {\n    var _form$getFieldsValue = form.getFieldsValue(),\n        openTime = _form$getFieldsValue.openTime,\n        reportTime = _form$getFieldsValue.reportTime,\n        params = _objectWithoutProperties(_form$getFieldsValue, [\"openTime\", \"reportTime\"]);\n\n    if (Array.isArray(openTime) && openTime.length == 2) {\n      params.startCreateAccountDate = moment(openTime[0]).format('YYYY-MM-DD');\n      params.endCreateAccountDate = moment(openTime[1]).format('YYYY-MM-DD');\n    }\n\n    if (Array.isArray(reportTime) && reportTime.length == 2) {\n      params.startNeedReportDate = moment(reportTime[0]).format('YYYY-MM-DD');\n      params.endNeedReportDate = moment(reportTime[1]).format('YYYY-MM-DD');\n    }\n\n    props.search(params);\n  };\n\n  var resetForm = function resetForm() {\n    form.resetFields();\n    onSearch();\n  };\n\n  var exportData = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _form$getFieldsValue2, reportTime, params, _yield$apiRegulatory$, _yield$apiRegulatory$2, code, data;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _form$getFieldsValue2 = form.getFieldsValue(), reportTime = _form$getFieldsValue2.reportTime;\n              params = {};\n\n              if (!(Array.isArray(reportTime) && reportTime.length == 2)) {\n                _context.next = 14;\n                break;\n              }\n\n              params.startNeedReportDate = moment(reportTime[0]).format('YYYY-MM-DD');\n              params.endNeedReportDate = moment(reportTime[1]).format('YYYY-MM-DD');\n              _context.next = 7;\n              return apiRegulatory.exportSecondReportList(params);\n\n            case 7:\n              _yield$apiRegulatory$ = _context.sent;\n              _yield$apiRegulatory$2 = _yield$apiRegulatory$.data;\n              code = _yield$apiRegulatory$2.code;\n              data = _yield$apiRegulatory$2.data;\n\n              if (code == 0) {\n                getFileAndDownload(data.fileName, data.fileBase64);\n              }\n\n              _context.next = 15;\n              break;\n\n            case 14:\n              _message.error('请选择上报日期');\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function exportData() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var getFileAndDownload = function getFileAndDownload(fileName, url) {\n    var x = new XMLHttpRequest();\n    x.open('GET', url, true);\n    x.responseType = 'blob';\n\n    x.onload = function (e) {\n      var blob = x.response;\n\n      if ('msSaveOrOpenBlob' in navigator) {\n        //IE导出\n        window.navigator.msSaveOrOpenBlob(blob, fileName);\n      } else {\n        var a = document.createElement('a');\n        a.download = fileName;\n        a.href = URL.createObjectURL(blob);\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n      }\n    };\n\n    x.send();\n  };\n\n  return __jsx(_Card, {\n    style: {\n      marginBottom: 30\n    }\n  }, __jsx(_Form, {\n    form: form,\n    name: \"search\",\n    initialValues: {\n      status: null,\n      catId: null\n    },\n    layout: \"inline\"\n  }, __jsx(_Form.Item, {\n    label: \"\\u5B58\\u6B3E\\u4EBA\\u59D3\\u540D\",\n    name: \"name\"\n  }, __jsx(_Input, {\n    placeholder: \"\\u5B58\\u6B3E\\u4EBA\\u59D3\\u540D\",\n    style: {\n      width: 150\n    }\n  })), __jsx(_Form.Item, {\n    label: \"\\u624B\\u673A\\u53F7\",\n    name: \"mobilePhone\"\n  }, __jsx(_Input, {\n    placeholder: \"\\u624B\\u673A\\u53F7\",\n    style: {\n      width: 150\n    }\n  })), __jsx(_Form.Item, {\n    label: \"\\u5B58\\u6B3E\\u4EBA\\u8EAB\\u4EFD\\u8BC1\\u4EF6\\u53F7\\u7801\",\n    name: \"idCard\"\n  }, __jsx(_Input, {\n    placeholder: \"\\u5B58\\u6B3E\\u4EBA\\u8EAB\\u4EFD\\u8BC1\\u4EF6\\u53F7\\u7801\",\n    style: {\n      width: 150\n    }\n  })), __jsx(_Form.Item, {\n    label: \"\\u8D26\\u53F7\",\n    name: \"cardNo\"\n  }, __jsx(_Input, {\n    placeholder: \"\\u8D26\\u53F7\",\n    style: {\n      width: 150\n    }\n  })), __jsx(_Form.Item, {\n    label: \"\\u4FE1\\u606F\\u7C7B\\u578B\",\n    name: \"catId\"\n  }, __jsx(_Select, {\n    style: {\n      width: 150\n    }\n  }, __jsx(_Select.Option, {\n    value: null\n  }, \"\\u5168\\u90E8\"), props.allCategory.map(function (v, i) {\n    return __jsx(_Select.Option, {\n      value: v.id + '',\n      key: i\n    }, v.name);\n  }))), __jsx(_Form.Item, {\n    label: \"\\u4E0A\\u62A5\\u72B6\\u6001\",\n    name: \"status\"\n  }, __jsx(_Select, {\n    style: {\n      width: 120\n    }\n  }, __jsx(_Select.Option, {\n    value: null\n  }, \"\\u5168\\u90E8\"), SECOND_REPORT_TYPE.map(function (v, i) {\n    return __jsx(_Select.Option, {\n      value: v.key,\n      key: i\n    }, v.name);\n  }))), __jsx(_Form.Item, {\n    label: \"\\u5F00\\u6237\\u65E5\\u671F\",\n    name: \"openTime\"\n  }, __jsx(RangePicker, null)), __jsx(_Form.Item, {\n    label: \"\\u5E94\\u4E0A\\u62A5\\u65E5\\u671F\",\n    name: \"reportTime\"\n  }, __jsx(RangePicker, null)), __jsx(_Form.Item, null, __jsx(_Button, {\n    type: \"primary\",\n    onClick: onSearch\n  }, \"\\u67E5\\u8BE2\")), __jsx(_Form.Item, null, __jsx(_Button, {\n    onClick: resetForm\n  }, \"\\u91CD\\u7F6E\")), __jsx(_Form.Item, null, __jsx(_Button, {\n    type: \"primary\",\n    onClick: exportData\n  }, \"\\u5BFC\\u51FA\\u4E0A\\u62A5\\u6587\\u4EF6\"))));\n}","map":null,"metadata":{},"sourceType":"module"}