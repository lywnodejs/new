{"ast":null,"code":"import \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/card/style\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/list/style\";\nimport _List from \"antd/lib/list\";\nimport \"antd/lib/radio/style\";\nimport _Radio from \"antd/lib/radio\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/row/style\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/space/style\";\nimport _Space from \"antd/lib/space\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/col/style\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from 'react';\nimport api from '~/api/collection';\nexport default function SendSms(props) {\n  var _useState = useState(false),\n      visible = _useState[0],\n      setVisible = _useState[1];\n\n  var _React$useState = React.useState(null),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      value = _React$useState2[0],\n      setValue = _React$useState2[1];\n\n  var _React$useState3 = React.useState(null),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      keyword = _React$useState4[0],\n      setKeyword = _React$useState4[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState([]),\n      tempList = _useState3[0],\n      setTempList = _useState3[1];\n\n  var _useState4 = useState(0),\n      num = _useState4[0],\n      setNum = _useState4[1];\n\n  useEffect(function () {\n    if (visible) {\n      setValue(null);\n      setKeyword(null);\n      getTempList();\n    }\n  }, [visible]);\n\n  var getTempList = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var params,\n          _yield$api$fetch_sms_,\n          _yield$api$fetch_sms_2,\n          data,\n          code,\n          result,\n          _args = arguments;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              params = _args.length > 0 && _args[0] !== undefined ? _args[0] : {};\n              _context.next = 3;\n              return api.fetch_sms_list(_objectSpread(_objectSpread({}, params), {}, {\n                phoneEncrypt: props.mobilePhoneEncrypt,\n                outOdernNum: props.outOrderNum\n              }));\n\n            case 3:\n              _yield$api$fetch_sms_ = _context.sent;\n              _yield$api$fetch_sms_2 = _yield$api$fetch_sms_.data;\n              data = _yield$api$fetch_sms_2.data;\n              code = _yield$api$fetch_sms_2.code;\n\n              if (code == 0) {\n                result = [];\n\n                if (Array.isArray(data.smsList)) {\n                  result = data.smsList.map(function (v, i) {\n                    var keys = Object.keys(v);\n                    return {\n                      title: v[keys[0]],\n                      id: keys[0]\n                    };\n                  });\n                }\n\n                setTempList(result);\n                setNum(data.num || 0);\n              }\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function getTempList() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var onClickItem = function onClickItem(item) {\n    var val = item.id == value ? null : item.id;\n    setValue(val);\n  };\n\n  var handleOk = function handleOk() {\n    if (!value) {\n      return _message.error('请先选择一个模板');\n    }\n\n    setLoading(true);\n    api.add_sms_one({\n      phoneEncrypt: props.mobilePhoneEncrypt,\n      outOdernNum: props.outOrderNum,\n      templateId: value\n    }).then(function (_ref2) {\n      var code = _ref2.data.code;\n\n      if (code == 0) {\n        _message.success('发送成功');\n\n        setVisible(false);\n      }\n    })[\"finally\"](function () {\n      setLoading(false);\n    });\n  };\n\n  var onReset = function onReset() {\n    setKeyword(null);\n    getTempList();\n  };\n\n  return __jsx(React.Fragment, null, __jsx(\"a\", {\n    onClick: function onClick() {\n      return setVisible(true);\n    }\n  }, \"\\u53D1\\u9001\\u77ED\\u4FE1\"), __jsx(_Modal, {\n    title: \"\\u53D1\\u9001\\u77ED\\u4FE1\",\n    width: 750,\n    visible: visible,\n    confirmLoading: loading,\n    onCancel: function onCancel() {\n      return setVisible(false);\n    },\n    footer: __jsx(_Row, {\n      align: \"middle\",\n      justify: \"space-between\"\n    }, __jsx(_Col, null, \"\\u6CE8*\\u5F53\\u524D\\u8BA2\\u5355\\u4ECA\\u65E5\\u53EF\\u53D1\\u9001\\u6570\\u91CF\", num, \"\\u6761\\u3002\"), __jsx(_Col, null, __jsx(_Space, null, __jsx(_Button, {\n      onClick: function onClick() {\n        return setVisible(false);\n      }\n    }, \"\\u53D6\\u6D88\"), __jsx(_Button, {\n      type: \"primary\",\n      onClick: handleOk\n    }, \"\\u53D1\\u9001\"))))\n  }, __jsx(_Space, {\n    style: {\n      marginBottom: 30\n    }\n  }, __jsx(\"span\", null, \"\\u5173\\u952E\\u5B57\\uFF1A\"), __jsx(_Input, {\n    placeholder: \"\\u8BF7\\u8F93\\u5165\",\n    onChange: function onChange(e) {\n      return setKeyword(e.target.value);\n    },\n    value: keyword,\n    style: {\n      marginRight: 30\n    }\n  }), __jsx(_Button, {\n    type: \"primary\",\n    onClick: function onClick() {\n      return getTempList({\n        keyword: keyword\n      });\n    }\n  }, \"\\u67E5\\u8BE2\"), __jsx(_Button, {\n    onClick: onReset\n  }, \"\\u91CD\\u7F6E\")), __jsx(_Card, {\n    title: \"\\u77ED\\u4FE1\\u6A21\\u677F\"\n  }, __jsx(_Radio.Group, {\n    style: {\n      width: '100%'\n    },\n    value: value\n  }, __jsx(_List, {\n    itemLayout: \"horizontal\",\n    dataSource: tempList,\n    renderItem: function renderItem(item) {\n      return __jsx(_List.Item, {\n        key: item.id,\n        onClick: function onClick() {\n          return onClickItem(item);\n        },\n        actions: [__jsx(_Radio, {\n          readonly: true,\n          value: item.id\n        })]\n      }, __jsx(\"span\", null, item.id, \"\\u2003\"), __jsx(\"span\", {\n        style: {\n          color: '#999'\n        }\n      }, item.title));\n    }\n  })))));\n}","map":null,"metadata":{},"sourceType":"module"}