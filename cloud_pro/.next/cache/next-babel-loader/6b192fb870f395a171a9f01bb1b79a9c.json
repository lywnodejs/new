{"ast":null,"code":"import \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/descriptions/style\";\nimport _Descriptions from \"antd/lib/descriptions\";\nimport \"antd/lib/spin/style\";\nimport _Spin from \"antd/lib/spin\";\nimport \"antd/lib/divider/style\";\nimport _Divider from \"antd/lib/divider\";\nimport \"antd/lib/upload/style\";\nimport _Upload from \"antd/lib/upload\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { UploadOutlined } from '@ant-design/icons';\nimport { useState } from 'react';\nimport apiRegulatory from '~/api/regulatory';\nexport default function (props) {\n  var _useState = useState([]),\n      fileList = _useState[0],\n      setFileList = _useState[1];\n\n  var _useState2 = useState({}),\n      result = _useState2[0],\n      setResult = _useState2[1];\n\n  var _useState3 = useState(false),\n      loading = _useState3[0],\n      setLoading = _useState3[1];\n\n  var handleOk = function handleOk() {\n    setFileList([]);\n    setResult({});\n    setLoading(false);\n    props.setVisible(false);\n  };\n\n  var handleCancel = function handleCancel() {\n    setFileList([]);\n    setResult({}); // props.setVisible(false)\n  };\n\n  var uploadFile = function uploadFile(file) {\n    setLoading(true);\n    var reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onload = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var results, valuesData, _yield$apiRegulatory$, _yield$apiRegulatory$2, data, code, desc;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              results = reader.result.split('base64,');\n              valuesData = {\n                fileName: file.name,\n                fileBase64: results[1]\n              };\n              _context.prev = 2;\n              _context.next = 5;\n              return apiRegulatory.uploadCreditReportList(_objectSpread({}, valuesData))[\"finally\"](function () {\n                setLoading(false);\n              });\n\n            case 5:\n              _yield$apiRegulatory$ = _context.sent;\n              _yield$apiRegulatory$2 = _yield$apiRegulatory$.data;\n              data = _yield$apiRegulatory$2.data;\n              code = _yield$apiRegulatory$2.code;\n              desc = _yield$apiRegulatory$2.desc;\n\n              if (code == 0) {\n                setResult(data);\n              } else {// setResult({\n                //   successNum: 100,\n                //   errorNum: 4,\n                //   failFileBase64: 'http://localhost:3010/regulatory/credit'\n                // })\n              }\n\n              _context.next = 16;\n              break;\n\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context[\"catch\"](2);\n              console.log(_context.t0);\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 13]]);\n    }));\n  };\n\n  var downloadData = function downloadData() {\n    if (!result.failFileBase64) return;\n    window.open(result.failFileBase64);\n  };\n\n  var UploadProps = {\n    name: 'file',\n    // accept:\n    // '.csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n    // beforeUpload: (file) => {\n    //   return false\n    // },\n    customRequest: function customRequest(options) {\n      // message.error('')\n      setFileList([options.file]);\n      uploadFile(options.file);\n    }\n  };\n\n  var onRemove = function onRemove(v) {\n    setFileList([]);\n  };\n\n  return __jsx(_Modal, {\n    visible: props.visible,\n    okText: \"\\u5173\\u95ED\",\n    cancelText: \"\\u91CD\\u7F6E\",\n    onOk: handleOk,\n    onCancel: handleCancel,\n    destroyOnClose: true,\n    title: \"\\u5BFC\\u5165\\u53CD\\u9988\\u6587\\u4EF6\"\n  }, __jsx(_Upload, _extends({}, UploadProps, {\n    onRemove: onRemove,\n    fileList: fileList\n  }), __jsx(_Button, {\n    icon: __jsx(UploadOutlined, null)\n  }, \"\\u9009\\u62E9\\u6587\\u4EF6\")), __jsx(_Divider, null), __jsx(_Descriptions, {\n    title: \"\\u5BFC\\u5165\\u7ED3\\u679C\",\n    column: 1\n  }, loading ? __jsx(_Descriptions.Item, null, __jsx(_Spin, {\n    size: \"large\"\n  })) : __jsx(React.Fragment, null, __jsx(_Descriptions.Item, {\n    label: \"\\u4E0A\\u62A5\\u6210\\u529F\\u6570\\u91CF\"\n  }, result.successNum || 0), __jsx(_Descriptions.Item, {\n    label: \"\\u4E0A\\u62A5\\u9519\\u8BEF\\u6570\\u91CF\"\n  }, result.errorNum || 0), __jsx(_Descriptions.Item, {\n    label: \"\\u4E0B\\u8F7D\\u5931\\u8D25\\u6570\\u636E\",\n    contentStyle: {\n      alignItems: 'center'\n    }\n  }, __jsx(_Button, {\n    disabled: !result.failFileBase64,\n    onClick: downloadData\n  }, \"\\u4E0B\\u8F7D\")))));\n}","map":{"version":3,"sources":["/Users/liuyawei/Desktop/信用算力/项目/cloud_pro/pages/regulatory/credit/importData.js"],"names":["UploadOutlined","useState","apiRegulatory","props","fileList","setFileList","result","setResult","loading","setLoading","handleOk","setVisible","handleCancel","uploadFile","file","reader","FileReader","readAsDataURL","onload","results","split","valuesData","fileName","name","fileBase64","uploadCreditReportList","data","code","desc","console","log","downloadData","failFileBase64","window","open","UploadProps","customRequest","options","onRemove","v","visible","successNum","errorNum","alignItems"],"mappings":"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","sourcesContent":["import {Modal, Upload, Divider, Button, Descriptions, message} from 'antd'\nimport {UploadOutlined} from '@ant-design/icons'\nimport {useState} from 'react'\nimport apiRegulatory from '~/api/regulatory'\nimport {Spin} from 'antd'\nexport default function (props) {\n  const [fileList, setFileList] = useState([])\n  const [result, setResult] = useState({})\n  const [loading, setLoading] = useState(false)\n\n  const handleOk = () => {\n    setFileList([])\n    setResult({})\n    setLoading(false)\n    props.setVisible(false)\n  }\n\n  const handleCancel = () => {\n    setFileList([])\n    setResult({})\n    // props.setVisible(false)\n  }\n\n  const uploadFile = (file) => {\n    setLoading(true)\n    let reader = new FileReader()\n\n    reader.readAsDataURL(file)\n    reader.onload = async () => {\n      let results = reader.result.split('base64,')\n      let valuesData = {\n        fileName: file.name,\n        fileBase64: results[1],\n      }\n      try {\n        const {\n          data: {data, code, desc},\n        } = await apiRegulatory\n          .uploadCreditReportList({\n            ...valuesData,\n          })\n          .finally(() => {\n            setLoading(false)\n          })\n        if (code == 0) {\n          setResult(data)\n        } else {\n          // setResult({\n          //   successNum: 100,\n          //   errorNum: 4,\n          //   failFileBase64: 'http://localhost:3010/regulatory/credit'\n          // })\n        }\n      } catch (error) {\n        console.log(error)\n      }\n    }\n  }\n\n  const downloadData = () => {\n    if (!result.failFileBase64) return\n    window.open(result.failFileBase64)\n  }\n\n  const UploadProps = {\n    name: 'file',\n    // accept:\n    // '.csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n    // beforeUpload: (file) => {\n    //   return false\n    // },\n    customRequest: (options) => {\n      // message.error('')\n      setFileList([options.file])\n      uploadFile(options.file)\n    },\n  }\n\n  const onRemove = (v) => {\n    setFileList([])\n  }\n\n  return (\n    <Modal\n      visible={props.visible}\n      okText=\"关闭\"\n      cancelText=\"重置\"\n      onOk={handleOk}\n      onCancel={handleCancel}\n      destroyOnClose\n      title=\"导入反馈文件\"\n    >\n      <Upload {...UploadProps} onRemove={onRemove} fileList={fileList}>\n        <Button icon={<UploadOutlined />}>选择文件</Button>\n      </Upload>\n\n      <Divider />\n\n      <Descriptions title=\"导入结果\" column={1}>\n        {loading ? (\n          <Descriptions.Item>\n            <Spin size=\"large\" />\n          </Descriptions.Item>\n        ) : (\n          <React.Fragment>\n            <Descriptions.Item label=\"上报成功数量\">\n              {result.successNum || 0}\n            </Descriptions.Item>\n            <Descriptions.Item label=\"上报错误数量\">\n              {result.errorNum || 0}\n            </Descriptions.Item>\n            <Descriptions.Item\n              label=\"下载失败数据\"\n              contentStyle={{alignItems: 'center'}}\n            >\n              <Button disabled={!result.failFileBase64} onClick={downloadData}>\n                下载\n              </Button>\n            </Descriptions.Item>\n          </React.Fragment>\n        )}\n      </Descriptions>\n    </Modal>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}