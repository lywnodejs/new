{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/config-provider/style\";\nimport _ConfigProvider from \"antd/lib/config-provider\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport axios from 'axios';\nimport zhCN from 'antd/lib/locale/zh_CN';\nimport api from '~/api/product';\nimport { cookies } from '~/utils';\nimport '~/themes/index.less';\nimport { CommonLayout } from '~/components/Layout/Layout';\nimport Login from '~/pages/login';\nexport var Context = React.createContext();\n\nvar Main = function Main(_ref) {\n  var statusCode = _ref.statusCode,\n      Component = _ref.Component,\n      pageProps = _ref.pageProps,\n      isServer = _ref.isServer;\n\n  if ((statusCode === -8 || statusCode === 1) && isServer) {\n    return __jsx(Login, null);\n  }\n\n  if (pageProps.login) {\n    return __jsx(Component, pageProps);\n  } // if (statusCode > -8 && statusCode < -4 && isServer) {\n  //   return <Error {...{statusCode: STATUSCODE[statusCode]}} />\n  // }\n\n\n  return __jsx(CommonLayout, null, __jsx(Component, pageProps));\n};\n\n_c = Main;\n\nfunction App(_ref2) {\n  var Component = _ref2.Component,\n      pageProps = _ref2.pageProps,\n      statusCode = _ref2.statusCode,\n      isServer = _ref2.isServer,\n      menu = _ref2.menu;\n  return __jsx(_ConfigProvider, {\n    locale: zhCN\n  }, __jsx(Context.Provider, {\n    value: {\n      menu: menu\n    }\n  }, __jsx(Main, {\n    Component: Component,\n    pageProps: pageProps,\n    statusCode: statusCode,\n    isServer: isServer\n  })));\n}\n\n_c2 = App;\n\nApp.getInitialProps = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(appContext) {\n    var statusCode, cookie, _cookies, sessionId, pageProps, menu, _yield$api$get_menu_l, _yield$api$get_menu_l2, code, data;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            statusCode = 0;\n\n            if (appContext.ctx.req !== undefined) {\n              axios.defaults.baseURL = \"\".concat(appContext.ctx.req.protocol, \"://\").concat(appContext.ctx.req.headers.host);\n\n              if (appContext.ctx.req.headers && appContext.ctx.req.headers.cookie) {\n                // console.log('server:', appContext.ctx.req.headers.cookie)\n                cookie = appContext.ctx.req.headers.cookie.replace('sessionId=undefined;', '');\n                _cookies = cookies(cookie), sessionId = _cookies.sessionId;\n                delete axios.defaults.headers.common['token'];\n\n                if (sessionId !== undefined && sessionId !== 'undefined') {\n                  axios.defaults.headers.common['token'] = sessionId;\n                }\n              }\n            } else {\n              delete axios.defaults.baseURL;\n            }\n\n            pageProps = {}; // let {menu} = await import('~/lib/menu')\n\n            menu = [];\n            _context.prev = 4;\n            _context.next = 7;\n            return api.get_menu_list();\n\n          case 7:\n            _yield$api$get_menu_l = _context.sent;\n            _yield$api$get_menu_l2 = _yield$api$get_menu_l.data;\n            code = _yield$api$get_menu_l2.code;\n            data = _yield$api$get_menu_l2.data;\n\n            // console.log(code, data)\n            if (code == 0 && Array.isArray(data)) {\n              menu = data;\n            }\n\n            statusCode = code;\n            _context.next = 19;\n            break;\n\n          case 15:\n            _context.prev = 15;\n            _context.t0 = _context[\"catch\"](4);\n            console.log(_context.t0);\n            menu = [];\n\n          case 19:\n            if (!appContext.Component.getInitialProps) {\n              _context.next = 24;\n              break;\n            }\n\n            _context.next = 22;\n            return appContext.Component.getInitialProps(appContext);\n\n          case 22:\n            pageProps = _context.sent;\n            statusCode = pageProps.code;\n\n          case 24:\n            return _context.abrupt(\"return\", {\n              pageProps: pageProps,\n              menu: menu,\n              statusCode: statusCode,\n              isServer: appContext.ctx.req !== undefined\n            });\n\n          case 25:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[4, 15]]);\n  }));\n\n  return function (_x) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nexport default App;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Main\");\n$RefreshReg$(_c2, \"App\");","map":{"version":3,"sources":["/Users/liuyawei/Desktop/信用算力/项目/cloud_pro/pages/_app.js"],"names":["React","axios","zhCN","api","cookies","CommonLayout","Login","Context","createContext","Main","statusCode","Component","pageProps","isServer","login","App","menu","getInitialProps","appContext","ctx","req","undefined","defaults","baseURL","protocol","headers","host","cookie","replace","sessionId","common","get_menu_list","data","code","Array","isArray","console","log"],"mappings":"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","sourcesContent":["import React from 'react'\nimport axios from 'axios'\nimport {ConfigProvider} from 'antd'\nimport zhCN from 'antd/lib/locale/zh_CN'\nimport api from '~/api/product'\nimport {cookies} from '~/utils'\nimport '~/themes/index.less'\nimport {CommonLayout} from '~/components/Layout/Layout'\nimport Login from '~/pages/login'\n\nexport const Context = React.createContext()\n\nconst Main = ({statusCode, Component, pageProps, isServer}) => {\n  if ((statusCode === -8 || statusCode === 1) && isServer) {\n    return <Login />\n  }\n\n  if (pageProps.login) {\n    return <Component {...pageProps} />\n  }\n\n  // if (statusCode > -8 && statusCode < -4 && isServer) {\n  //   return <Error {...{statusCode: STATUSCODE[statusCode]}} />\n  // }\n\n  return (\n    <CommonLayout>\n      <Component {...pageProps} />\n    </CommonLayout>\n  )\n}\n\nfunction App({Component, pageProps, statusCode, isServer, menu}) {\n  return (\n    <ConfigProvider locale={zhCN}>\n      <Context.Provider value={{menu}}>\n        <Main {...{Component, pageProps, statusCode, isServer}} />\n      </Context.Provider>\n    </ConfigProvider>\n  )\n}\n\nApp.getInitialProps = async (appContext) => {\n  let statusCode = 0\n\n  if (appContext.ctx.req !== undefined) {\n    axios.defaults.baseURL = `${appContext.ctx.req.protocol}://${appContext.ctx.req.headers.host}`\n\n    if (appContext.ctx.req.headers && appContext.ctx.req.headers.cookie) {\n      // console.log('server:', appContext.ctx.req.headers.cookie)\n      const cookie = appContext.ctx.req.headers.cookie.replace(\n        'sessionId=undefined;',\n        '',\n      )\n\n      const {sessionId} = cookies(cookie)\n\n      delete axios.defaults.headers.common['token']\n\n      if (sessionId !== undefined && sessionId !== 'undefined') {\n        axios.defaults.headers.common['token'] = sessionId\n      }\n    }\n  } else {\n    delete axios.defaults.baseURL\n  }\n\n  let pageProps = {}\n  // let {menu} = await import('~/lib/menu')\n  let menu = []\n  try {\n    const {\n      data: {code, data},\n    } = await api.get_menu_list()\n    // console.log(code, data)\n    if (code == 0 && Array.isArray(data)) {\n      menu = data\n    }\n    statusCode = code\n  } catch (e) {\n    console.log(e)\n    menu = []\n  }\n\n  if (appContext.Component.getInitialProps) {\n    pageProps = await appContext.Component.getInitialProps(appContext)\n    statusCode = pageProps.code\n  }\n\n  return {\n    pageProps,\n    menu,\n    statusCode,\n    isServer: appContext.ctx.req !== undefined,\n  }\n}\n\nexport default App\n"]},"metadata":{},"sourceType":"module"}