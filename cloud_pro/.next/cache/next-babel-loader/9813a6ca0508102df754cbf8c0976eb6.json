{"ast":null,"code":"import \"antd/lib/space/style\";\nimport _Space from \"antd/lib/space\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/select/style\";\nimport _Select from \"antd/lib/select\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Layout } from '~/components/Layout';\nimport React, { useEffect, useState } from 'react';\nimport { useCookies } from 'react-cookie';\nimport api from '~/api/authority';\nimport apiInCollection from '~/api/collection';\nimport AccountForm from './accountForm';\nimport TableList from './TableList';\nimport _ from 'lodash';\nvar breadcrumbs = [{\n  text: '权限管理'\n}, {\n  text: '成员管理'\n}];\n\nfunction body(props) {\n  var _useCookies = useCookies(['tenantId']),\n      _useCookies2 = _slicedToArray(_useCookies, 1),\n      cookies = _useCookies2[0];\n\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  var _useState = useState({\n    list: [],\n    total: 0\n  }),\n      data = _useState[0],\n      setData = _useState[1];\n\n  var _useState2 = useState([]),\n      roles = _useState2[0],\n      setRoles = _useState2[1];\n\n  var _useState3 = useState(false),\n      visible = _useState3[0],\n      setVisible = _useState3[1];\n\n  var _useState4 = useState(-1),\n      selectIndex = _useState4[0],\n      setIndex = _useState4[1];\n\n  var _useState5 = useState({}),\n      selectItem = _useState5[0],\n      setSelectItem = _useState5[1];\n\n  var _useState6 = useState([]),\n      departments = _useState6[0],\n      setDepartments = _useState6[1];\n\n  var _useState7 = useState([]),\n      showDepartments = _useState7[0],\n      setShowDepartments = _useState7[1];\n\n  var _useState8 = useState([]),\n      showRoles = _useState8[0],\n      setShowRoles = _useState8[1];\n\n  var _useState9 = useState({\n    pageNo: 1,\n    pageSize: 10\n  }),\n      pageParams = _useState9[0],\n      setPageParams = _useState9[1];\n\n  useEffect(function () {\n    fetchList(pageParams);\n    fetchDepartment();\n    fetchRoles();\n  }, []);\n\n  var fetchDepartment = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _yield$api$getVisible, _data;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return api.getVisibleDepart();\n\n            case 3:\n              _yield$api$getVisible = _context.sent;\n              _data = _yield$api$getVisible.data;\n\n              if (_data.code == 0) {\n                setDepartments(_data.data);\n                setShowDepartments(_data.data);\n              }\n\n              _context.next = 11;\n              break;\n\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](0);\n              console.log(_context.t0);\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 8]]);\n    }));\n\n    return function fetchDepartment() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleSearchDepart = function handleSearchDepart(keyword) {\n    if (!keyword) {\n      return setShowDepartments(departments);\n    }\n\n    var arr = departments.filter(function (v) {\n      return v.name.indexOf(keyword) > -1;\n    });\n    setShowDepartments(arr);\n  };\n\n  var handleChangeDepart = function handleChangeDepart() {\n    setShowDepartments(departments);\n  };\n\n  var fetchRoles = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(keyword) {\n      var params, _yield$api$getRoleLis, _yield$api$getRoleLis2, _data2, code;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              params = {};\n\n              if (keyword) {\n                params.keyword = keyword;\n              }\n\n              _context2.prev = 2;\n              _context2.next = 5;\n              return api.getRoleList(params);\n\n            case 5:\n              _yield$api$getRoleLis = _context2.sent;\n              _yield$api$getRoleLis2 = _yield$api$getRoleLis.data;\n              _data2 = _yield$api$getRoleLis2.data;\n              code = _yield$api$getRoleLis2.code;\n\n              if (code === 0) {\n                if (!keyword) {\n                  setRoles(_data2.list);\n                }\n\n                setShowRoles(_data2.list);\n              }\n\n              _context2.next = 15;\n              break;\n\n            case 12:\n              _context2.prev = 12;\n              _context2.t0 = _context2[\"catch\"](2);\n              console.log(_context2.t0);\n\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[2, 12]]);\n    }));\n\n    return function fetchRoles(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var _fetchRoles = _.debounce(fetchRoles, 300);\n\n  var handleSearchRole = function handleSearchRole(v) {\n    _fetchRoles(v);\n  };\n\n  var handleChangeRole = function handleChangeRole() {\n    setShowRoles(roles);\n  };\n\n  var fetchList = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(values) {\n      var _yield$api$getAccount, _yield$api$getAccount2, _data3, code;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _context3.next = 3;\n              return api.getAccount(_objectSpread({}, values));\n\n            case 3:\n              _yield$api$getAccount = _context3.sent;\n              _yield$api$getAccount2 = _yield$api$getAccount.data;\n              _data3 = _yield$api$getAccount2.data;\n              code = _yield$api$getAccount2.code;\n\n              if (code === 0) {\n                setData(_data3);\n              }\n\n              _context3.next = 13;\n              break;\n\n            case 10:\n              _context3.prev = 10;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.log(_context3.t0);\n\n            case 13:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 10]]);\n    }));\n\n    return function fetchList(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var onAdd = function onAdd() {\n    setIndex(-1);\n    setVisible(true);\n    setSelectItem({});\n  };\n\n  var onReset = function onReset() {\n    form.resetFields();\n    onSearch();\n  };\n\n  var onSearch = function onSearch() {\n    changePageParams(1);\n  };\n\n  var changePageParams = function changePageParams() {\n    var pageNo = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : pageParams.pageNo;\n    var pageSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : pageParams.pageSize;\n    var pParams = {\n      pageNo: pageNo,\n      pageSize: pageSize\n    };\n\n    var params = _objectSpread(_objectSpread({}, form.getFieldsValue()), pParams);\n\n    setPageParams(pParams);\n    fetchList(params);\n  };\n\n  var onEdit = function onEdit(item) {\n    setIndex(item.id);\n    setVisible(true);\n    setSelectItem(item);\n  };\n\n  return __jsx(Layout, {\n    breadcrumbs: breadcrumbs\n  }, __jsx(_Space, {\n    direction: \"vertical\",\n    size: \"large\",\n    style: {\n      width: '100%'\n    }\n  }, __jsx(_Form, {\n    form: form,\n    onFinish: onSearch,\n    layout: \"inline\",\n    className: \"searchForm\",\n    initialValues: {\n      keyword: '',\n      departmentId: null,\n      roleId: null\n    }\n  }, __jsx(_Form.Item, {\n    label: \"\\u5173\\u952E\\u5B57\",\n    name: \"keyword\"\n  }, __jsx(_Input, {\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u5173\\u952E\\u5B57\"\n  })), __jsx(_Form.Item, {\n    label: \"\\u90E8\\u95E8\",\n    name: \"departmentId\"\n  }, __jsx(_Select, {\n    showSearch: true,\n    placeholder: \"\\u8BF7\\u9009\\u62E9\\u90E8\\u95E8\",\n    filterOption: false,\n    defaultActiveFirstOption: false,\n    onSearch: handleSearchDepart,\n    onChange: handleChangeDepart,\n    style: {\n      width: '200px'\n    }\n  }, __jsx(_Select.Option, {\n    value: null,\n    key: -1\n  }, \"\\u5168\\u90E8\"), showDepartments.map(function (v, i) {\n    return __jsx(_Select.Option, {\n      value: v.id,\n      key: i\n    }, v.name);\n  }))), __jsx(_Form.Item, {\n    label: \"\\u89D2\\u8272\",\n    name: \"roleId\"\n  }, __jsx(_Select, {\n    showSearch: true,\n    placeholder: \"\\u8BF7\\u9009\\u62E9\\u89D2\\u8272\",\n    filterOption: false,\n    defaultActiveFirstOption: false,\n    onSearch: handleSearchRole,\n    onChange: handleChangeRole,\n    style: {\n      width: '200px'\n    }\n  }, __jsx(_Select.Option, {\n    value: null,\n    key: -1\n  }, \"\\u5168\\u90E8\"), showRoles.map(function (v) {\n    return __jsx(_Select.Option, {\n      value: v.id,\n      key: v.id\n    }, v.roleName);\n  }))), __jsx(_Button, {\n    type: \"primary\",\n    style: {\n      marginRight: 15\n    },\n    htmlType: \"submit\"\n  }, \"\\u67E5\\u8BE2\"), __jsx(_Button, {\n    style: {\n      marginRight: 15\n    },\n    onClick: onReset\n  }, \"\\u91CD\\u7F6E\"), __jsx(_Button, {\n    type: \"primary\",\n    onClick: onAdd\n  }, \"\\u65B0\\u589E\")), __jsx(TableList, {\n    data: data,\n    onEdit: onEdit,\n    pageParams: pageParams,\n    changePageParams: changePageParams\n  }), __jsx(AccountForm, {\n    handleSearchRole: handleSearchRole,\n    handleChangeRole: handleChangeRole,\n    handleSearchDepart: handleSearchDepart,\n    handleChangeDepart: handleChangeDepart,\n    showDepartments: showDepartments,\n    showRoles: showRoles,\n    selectIndex: selectIndex,\n    visible: visible,\n    selectItem: selectItem,\n    onHide: function onHide() {\n      return setVisible(false);\n    },\n    changePageParams: changePageParams\n  })));\n}\n\nbody.getInitialProps = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n  return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          return _context4.abrupt(\"return\", {});\n\n        case 1:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _callee4);\n}));\nexport default body;","map":null,"metadata":{},"sourceType":"module"}