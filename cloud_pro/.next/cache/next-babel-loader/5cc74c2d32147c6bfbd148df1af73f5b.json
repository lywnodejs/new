{"ast":null,"code":"import \"antd/lib/row/style\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/col/style\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { Layout } from '~/components/Layout';\nimport { useEffect, useState } from 'react';\nimport styles from './style.less';\nimport { LockOutlined, PhoneOutlined, MailOutlined } from '@ant-design/icons';\nimport { post, postForm } from '~/utils/fetch';\nimport { useCookies } from 'react-cookie';\nimport _ from 'lodash';\nimport { useRouter } from 'next/router';\nvar tailLayout = {\n  wrapperCol: {\n    span: 24\n  }\n};\n\nvar LoginForm = function LoginForm() {\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  var _useCookies = useCookies(['sessionId']),\n      _useCookies2 = _slicedToArray(_useCookies, 2),\n      cookies = _useCookies2[0],\n      setCookie = _useCookies2[1];\n\n  var _useState = useState(false),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var router = useRouter();\n\n  var _useState2 = useState('获取验证码'),\n      smsText = _useState2[0],\n      setSmsText = _useState2[1];\n\n  var _useState3 = useState(60),\n      time = _useState3[0],\n      setTime = _useState3[1];\n\n  var _useState4 = useState(null),\n      timer = _useState4[0],\n      setTimer = _useState4[1];\n\n  var onFinish = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(params) {\n      var _yield$postForm$catch, _yield$postForm$catch2, code, data, desc;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoading(true);\n              _context.next = 3;\n              return postForm('userManage/userLogin', params)[\"catch\"](function () {\n                setLoading(false);\n              });\n\n            case 3:\n              _yield$postForm$catch = _context.sent;\n              _yield$postForm$catch2 = _yield$postForm$catch.data;\n              code = _yield$postForm$catch2.code;\n              data = _yield$postForm$catch2.data;\n              desc = _yield$postForm$catch2.desc;\n              setLoading(false);\n\n              if (!(code !== 0)) {\n                _context.next = 11;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 11:\n              if (_.isObject(data) && _.isObject(data.authAccount)) {\n                if (data.authAccount.authToken) {\n                  setCookie('sessionId', data.authAccount.authToken, {\n                    path: '/'\n                  });\n                }\n\n                setCookie('dataScope', data.authAccount.dataScope, {\n                  path: '/'\n                });\n\n                if (data.authAccount.accountName) {\n                  setCookie('name', data.authAccount.accountName, {\n                    path: '/'\n                  });\n                }\n\n                if (data.authAccount.roleId) {\n                  setCookie('roleId', data.authAccount.roleId, {\n                    path: '/'\n                  });\n                }\n\n                if (data.authAccount.trueName) {\n                  setCookie('trueName', data.authAccount.trueName, {\n                    path: '/'\n                  });\n                }\n              }\n\n              if (_.isObject(data) && _.isObject(data.tenant)) {\n                if (data.tenant.id) {\n                  setCookie('tenantId', data.tenant.id, {\n                    path: '/'\n                  });\n                }\n              } // location.href = '/'\n\n\n              router.push('/');\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onFinish(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var getSmsCode = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var mobile, _yield$postForm, _yield$postForm$data, code, data, desc;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              mobile = form.getFieldValue('mobile');\n\n              if (!(timer || !mobile)) {\n                _context2.next = 3;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 3:\n              console.log('getSmsCode');\n              countDown();\n              _context2.next = 7;\n              return postForm('userManage/sendVerifyCode', {\n                mobile: mobile\n              });\n\n            case 7:\n              _yield$postForm = _context2.sent;\n              _yield$postForm$data = _yield$postForm.data;\n              code = _yield$postForm$data.code;\n              data = _yield$postForm$data.data;\n              desc = _yield$postForm$data.desc;\n\n              if (code == 0) {\n                _message.success('短信发送成功');\n              }\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function getSmsCode() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var countDown = function countDown() {\n    setSmsText(\"\".concat(time, \"s\\u540E\\u91CD\\u65B0\\u83B7\\u53D6\"));\n    var c_timer = setInterval(function () {\n      time--;\n\n      if (time === 0) {\n        clearInterval(c_timer);\n        setTimer(null);\n        setTime(60);\n        setSmsText('获取验证码');\n      } else {\n        setSmsText(\"\".concat(time, \"s\\u540E\\u91CD\\u65B0\\u83B7\\u53D6\"));\n      }\n    }, 1000);\n    setTimer(c_timer);\n  };\n\n  return __jsx(_Form, {\n    form: form,\n    style: {\n      width: '400px'\n    },\n    name: \"basic\",\n    initialValues: {// mobile: '13800001234',\n      // verifyCode: '123456',\n    },\n    onFinish: onFinish\n  }, __jsx(_Form.Item, {\n    name: \"mobile\",\n    rules: [{\n      required: true,\n      message: '请输入手机号'\n    }]\n  }, __jsx(_Input, {\n    placeholder: '请输入手机号',\n    size: \"large\",\n    style: {\n      width: '100%'\n    },\n    prefix: __jsx(PhoneOutlined, null)\n  })), __jsx(_Form.Item, {\n    name: \"verifyCode\",\n    rules: [{\n      required: true,\n      message: '请输入验证码'\n    }]\n  }, __jsx(_Input.Search, {\n    size: \"large\",\n    prefix: __jsx(MailOutlined, null),\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u9A8C\\u8BC1\\u7801\",\n    enterButton: smsText,\n    onSearch: getSmsCode\n  })), __jsx(_Form.Item, null, __jsx(_Button, {\n    loading: loading,\n    size: \"large\",\n    type: \"primary\",\n    htmlType: \"submit\",\n    block: true\n  }, \"\\u767B\\u5F55\")));\n};\n\nfunction body() {\n  return __jsx(\"div\", {\n    className: styles.wrapper\n  }, __jsx(_Row, {\n    justify: \"space-around\",\n    align: \"middle\",\n    className: styles.row\n  }, __jsx(_Col, {\n    span: 2\n  }), __jsx(_Col, null, __jsx(\"h1\", {\n    className: styles.h1\n  }, \"\\u4FE1\\u8D37\\u4E1A\\u52A1\\u7CFB\\u7EDF\"), __jsx(\"p\", {\n    className: styles.p\n  }), __jsx(LoginForm, null)), __jsx(_Col, {\n    span: 2\n  })));\n}\n\nbody.getInitialProps = function () {\n  return {\n    login: true\n  };\n};\n\nexport default body;","map":null,"metadata":{},"sourceType":"module"}