{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport \"antd/lib/card/style\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/descriptions/style\";\nimport _Descriptions from \"antd/lib/descriptions\";\nimport \"antd/lib/row/style\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/col/style\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/image/style\";\nimport _Image from \"antd/lib/image\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/tabs/style\";\nimport _Tabs from \"antd/lib/tabs\";\nimport \"antd/lib/steps/style\";\nimport _Steps from \"antd/lib/steps\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Layout } from '~/components/Layout';\nimport React, { useEffect, useState } from 'react';\nimport api from '~/api/collection';\nimport apiProduct from '~/api/product';\nimport _ from 'lodash';\nimport Contacts from '~/components/pages/collection/reminded/form/Contacts';\nimport History from '~/components/pages/collection/reminded/form/History';\nimport SendSms from '~/components/pages/collection/reminded/form/SendSms';\nimport styles from './index.less';\nvar Step = _Steps.Step;\nvar TabPane = _Tabs.TabPane;\nvar breadcrumbs = [{\n  text: '催收管理'\n}, {\n  text: '待催列表'\n}, {\n  text: '查看订单'\n}];\nvar idCardImgType = ['idCardFrontOcr', 'idCardBackOcr', 'livenessOcr'];\n\nvar getData = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(id) {\n    var _yield$api$fetch_orde, _yield$api$fetch_orde2, code, data;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return api.fetch_order_detail(id);\n\n          case 2:\n            _yield$api$fetch_orde = _context.sent;\n            _yield$api$fetch_orde2 = _yield$api$fetch_orde.data;\n            code = _yield$api$fetch_orde2.code;\n            data = _yield$api$fetch_orde2.data;\n            return _context.abrupt(\"return\", code == 0 ? data : {});\n\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function getData(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nfunction body(props) {\n  var _useState = useState({}),\n      detail = _useState[0],\n      setDetail = _useState[1];\n\n  var _useState2 = useState([]),\n      history = _useState2[0],\n      setHistory = _useState2[1];\n\n  var _useState3 = useState('history'),\n      defaultActiveKey = _useState3[0],\n      setDefaultActiveKey = _useState3[1];\n\n  useEffect(function () {\n    getDetail();\n  }, []);\n\n  var getDetail = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(key) {\n      var data, _data$loanApplyVo, catSnapShotDTOS, collectionOrderRecordList;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return getData(props.id);\n\n            case 2:\n              data = _context2.sent;\n\n              if (data && data.loanApplyVo) {\n                setDetail(data.loanApplyVo);\n                _data$loanApplyVo = data.loanApplyVo, catSnapShotDTOS = _data$loanApplyVo.catSnapShotDTOS, collectionOrderRecordList = _data$loanApplyVo.collectionOrderRecordList;\n\n                if (Array.isArray(catSnapShotDTOS) && catSnapShotDTOS.length > 0) {\n                  setDefaultActiveKey(key || '1');\n                }\n\n                if (Array.isArray(collectionOrderRecordList)) {\n                  setHistory(collectionOrderRecordList);\n                }\n              }\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function getDetail(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }(); // const reloadData = () => {}\n\n\n  var onContactMobile = function onContactMobile() {\n    var phones = [];\n    var mobilePhoneEncrypt = [];\n\n    if (detail.otherPhones) {\n      phones = detail.otherPhones.split(',');\n    }\n\n    if (detail.mobilePhoneEncrypt) {\n      mobilePhoneEncrypt = detail.mobilePhoneEncrypt.split(',');\n    }\n\n    return phones.length ? phones.map(function (phone, index) {\n      return __jsx(\"span\", {\n        style: {\n          marginRight: '6px'\n        }\n      }, phone);\n    }) : null;\n  };\n\n  var ContactList = function ContactList(props) {\n    var data = Array.isArray(props.data) ? _.cloneDeep(props.data) : [];\n    data = data.map(function (v, i) {\n      var arr = v.showValue ? v.showValue.split('|') : [];\n      return _objectSpread(_objectSpread({}, v), {}, {\n        userName: arr[0],\n        phoneNo: arr[1],\n        contactId: i\n      });\n    });\n    return __jsx(Contacts, _extends({\n      list: data,\n      reloadData: getDetail\n    }, props.initData, {\n      userId: detail.userId,\n      mobilePhoneEncrypt: detail.mobilePhoneEncrypt\n    })) // <Table\n    //   dataSource={data}\n    //   columns={contactColumns}\n    //   pagination={false}\n    //   rowKey=\"contactId\"\n    // />\n    ;\n  };\n\n  var ShowValContainer = function ShowValContainer(_ref3) {\n    var type = _ref3.type,\n        showValue = _ref3.showValue;\n\n    if (idCardImgType.indexOf(type) > -1) {\n      type = 'image';\n    }\n\n    if (type == 'image' || type == 'voice' || type == 'video') {\n      showValue = showValue ? showValue.split(',') : [];\n    }\n\n    var getByType = function getByType() {\n      var template = null;\n\n      switch (type) {\n        case 'image':\n          template = __jsx(\"div\", {\n            className: \"imageBox\"\n          }, __jsx(_Image.PreviewGroup, null, showValue.map(function (src, i) {\n            return __jsx(_Image, {\n              src: src,\n              key: i\n            });\n          })));\n          break;\n\n        case 'video':\n          template = __jsx(_Row, {\n            gutter: 10\n          }, showValue.map(function (src, i) {\n            return __jsx(_Col, {\n              key: i\n            }, __jsx(\"video\", {\n              width: \"100\",\n              height: \"75\",\n              controls: true\n            }, __jsx(\"source\", {\n              src: src,\n              type: \"video/mp4\"\n            }), __jsx(\"source\", {\n              src: src,\n              type: \"video/ogg\"\n            }), \"\\u60A8\\u7684\\u6D4F\\u89C8\\u5668\\u4E0D\\u652F\\u6301Video\\u6807\\u7B7E\\u3002\"));\n          }));\n          break;\n\n        case 'voice':\n          template = __jsx(\"audio\", {\n            controls: true\n          }, __jsx(\"source\", {\n            src: showValue,\n            type: \"audio/ogg\"\n          }), __jsx(\"source\", {\n            src: showValue,\n            type: \"audio/mpeg\"\n          }), \"\\u60A8\\u7684\\u6D4F\\u89C8\\u5668\\u4E0D\\u652F\\u6301 audio \\u5143\\u7D20\\u3002\");\n          break;\n\n        default:\n          template = showValue;\n      }\n\n      return template;\n    };\n\n    return __jsx(React.Fragment, null, getByType());\n  };\n\n  var ShowDescriptions = function ShowDescriptions(props) {\n    var list = props.data.list;\n    var template = Array.isArray(list) ? __jsx(_Descriptions, {\n      bordered: true\n    }, list.map(function (desc, desc_index) {\n      var values = desc.showValue;\n      var span = 1;\n\n      if (desc.attrType == 'image' || desc.attrType == 'voice' || desc.attrType == 'video') {\n        values = values ? values.split(',') : [];\n      }\n\n      if (Array.isArray(desc.list) && desc.list.length > 0 || desc.attrType == 'video' && Array.isArray(values) && values.length > 0) {\n        span = 3;\n      }\n\n      return __jsx(_Descriptions.Item, {\n        label: desc.attrName,\n        key: desc_index,\n        span: span\n      }, Array.isArray(desc.list) ? __jsx(ShowDescriptions, {\n        data: desc\n      }) : __jsx(ShowValContainer, {\n        type: desc.attrType,\n        showValue: desc.showValue\n      }));\n    })) : null;\n    return template;\n  };\n\n  return __jsx(Layout, {\n    breadcrumbs: breadcrumbs\n  }, __jsx(_Card, {\n    style: {\n      marginBottom: 15\n    }\n  }, __jsx(_Descriptions, {\n    title: \"\\u501F\\u636E\\u53F7\\uFF1A\".concat(detail.orderNum || '')\n  }, __jsx(_Descriptions.Item, {\n    label: \"\\u59D3\\u540D\"\n  }, detail.realName), __jsx(_Descriptions.Item, {\n    label: \"\\u624B\\u673A\\u53F7\"\n  }, detail.mobilePhone, \"\\uFF08\", __jsx(SendSms, {\n    mobilePhoneEncrypt: detail.mobilePhoneEncrypt,\n    outOrderNum: detail.outOrderNum\n  }), \"\\uFF09\"), __jsx(_Descriptions.Item, {\n    label: \"\\u8EAB\\u4EFD\\u8BC1\\u53F7\"\n  }, detail.idCard), __jsx(_Descriptions.Item, {\n    label: \"\\u7533\\u8BF7\\u4EA7\\u54C1\"\n  }, detail.productName), __jsx(_Descriptions.Item, {\n    label: \"\\u7533\\u8BF7\\u65F6\\u95F4\"\n  }, detail.createTimeStr), __jsx(_Descriptions.Item, {\n    label: \"\\u653E\\u6B3E\\u65B9\\u5F0F\"\n  }, detail.userAccountTypeDesc), __jsx(_Descriptions.Item, {\n    label: \"\\u501F\\u6B3E\\u6E20\\u9053\"\n  }, detail.applySourceName), __jsx(_Descriptions.Item, {\n    label: \"\\u7533\\u8BF7\\u91D1\\u989D\"\n  }, detail.signLoanAmount), __jsx(_Descriptions.Item, {\n    label: \"\\u7533\\u8BF7\\u671F\\u9650\"\n  }, detail.loanApplyTerms), __jsx(_Descriptions.Item, {\n    label: \"\\u7ED3\\u6E05\\u5355\\u6570\"\n  }, detail.finishedOrderNum), __jsx(_Descriptions.Item, {\n    label: \"\\u5173\\u8054\\u624B\\u673A\"\n  }, onContactMobile()))), __jsx(_Card, {\n    title: \"\\u7528\\u6237\\u57FA\\u672C\\u4FE1\\u606F\"\n  }, __jsx(_Tabs, {\n    animated: {\n      tabPane: true\n    },\n    activeKey: defaultActiveKey,\n    onTabClick: function onTabClick(key) {\n      return setDefaultActiveKey(key);\n    }\n  }, Array.isArray(detail.catSnapShotDTOS) && detail.catSnapShotDTOS.map(function (v, i) {\n    var key = i + 1 + '';\n    return __jsx(TabPane, {\n      className: styles.tabPaneBox,\n      tab: v.catName,\n      key: key\n    }, __jsx(_Card, {\n      title: v.catName\n    }, Array.isArray(v.secondLList) ? v.secondLList.map(function (s_item, s_index) {\n      return __jsx(_Card, {\n        style: {\n          marginBottom: 15\n        },\n        key: s_index,\n        type: \"inner\",\n        title: s_item.catName\n      }, s_item.catType === 'cat_ocr' && __jsx(_Image.PreviewGroup, null, __jsx(_Row, {\n        gutter: 25\n      }, Array.isArray(s_item.list) && s_item.list.filter(function (img) {\n        return idCardImgType.indexOf(img.attrType) > -1;\n      }).map(function (img, img_index) {\n        return __jsx(_Col, {\n          flex: \"0 0 200\",\n          key: img_index\n        }, __jsx(_Image, {\n          width: 200,\n          height: 150,\n          src: img.showValue\n        }), __jsx(\"div\", {\n          className: styles.imgTime\n        }, img.updateTime || '-'));\n      }))), s_item.catType !== 'cat_ocr' && s_item.catType !== 'cat_contact' && __jsx(ShowDescriptions, {\n        data: s_item\n      }), s_item.catType === 'cat_contact' && __jsx(ContactList, {\n        data: s_item.list,\n        initData: props\n      }));\n    }) : null));\n  }), __jsx(TabPane, {\n    tab: \"\\u50AC\\u6536\\u8BB0\\u5F55\",\n    key: \"history\"\n  }, __jsx(History, _extends({\n    list: history\n  }, props, {\n    reloadData: getDetail,\n    mobilePhoneEncrypt: detail.mobilePhoneEncrypt\n  }))))));\n}\n\nbody.getInitialProps = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(context) {\n    var backData, _yield$Promise$all, _yield$Promise$all2, _yield$Promise$all2$, data, code, _yield$Promise$all2$2, collectionLevels, levelCode, _yield$Promise$all2$3, urgeMethods, levelCode01, _yield$Promise$all2$4, urgeObjects, levelCode02, _yield$Promise$all2$5, urgeResults, levelCode03, _yield$Promise$all2$6, urgeResultUnknows, levelCode04, _yield$Promise$all2$7, urgeResultHighs, levelCode05, _yield$Promise$all2$8, urgeResultLows, levelCode06, _yield$Promise$all2$9, urgeIsConnects, levelCode07, _yield$Promise$all2$10, urgeReasonTypes, levelCode08, _yield$Promise$all2$11, urgeRepayDesires, levelCode09;\n\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            backData = {\n              collectionProducts: [],\n              collectionLevels: [],\n              urgeMethods: [],\n              urgeObjects: [],\n              urgeResults: [],\n              urgeResultUnknows: [],\n              urgeResultHighs: [],\n              urgeResultLows: [],\n              urgeIsConnects: [],\n              urgeReasonTypes: [],\n              urgeRepayDesires: [],\n              connectResults: [],\n              unConnectResults: [],\n              id: context.ctx.query.id\n            };\n            _context3.prev = 1;\n            _context3.next = 4;\n            return Promise.all([api.get_data_dict('COLLECTION_PRODUCT'), api.get_data_dict('COLLECTION_LEVEL'), api.get_data_dict('URGE_METHOD'), api.get_data_dict('URGE_OBJECT'), api.get_data_dict('URGE_RESULT'), api.get_data_dict('URGE_RESULT_UNKNOWN'), api.get_data_dict('URGE_RESULT_HIGH'), api.get_data_dict('URGE_RESULT_LOW'), api.get_data_dict('URGE_IS_CONNECT'), api.get_data_dict('URGE_REASON_TYPE'), api.get_data_dict('URGE_REPAY_DESIRE')]);\n\n          case 4:\n            _yield$Promise$all = _context3.sent;\n            _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 11);\n            _yield$Promise$all2$ = _yield$Promise$all2[0].data;\n            data = _yield$Promise$all2$.data;\n            code = _yield$Promise$all2$.code;\n            _yield$Promise$all2$2 = _yield$Promise$all2[1].data;\n            collectionLevels = _yield$Promise$all2$2.data;\n            levelCode = _yield$Promise$all2$2.code;\n            _yield$Promise$all2$3 = _yield$Promise$all2[2].data;\n            urgeMethods = _yield$Promise$all2$3.data;\n            levelCode01 = _yield$Promise$all2$3.code;\n            _yield$Promise$all2$4 = _yield$Promise$all2[3].data;\n            urgeObjects = _yield$Promise$all2$4.data;\n            levelCode02 = _yield$Promise$all2$4.code;\n            _yield$Promise$all2$5 = _yield$Promise$all2[4].data;\n            urgeResults = _yield$Promise$all2$5.data;\n            levelCode03 = _yield$Promise$all2$5.code;\n            _yield$Promise$all2$6 = _yield$Promise$all2[5].data;\n            urgeResultUnknows = _yield$Promise$all2$6.data;\n            levelCode04 = _yield$Promise$all2$6.code;\n            _yield$Promise$all2$7 = _yield$Promise$all2[6].data;\n            urgeResultHighs = _yield$Promise$all2$7.data;\n            levelCode05 = _yield$Promise$all2$7.code;\n            _yield$Promise$all2$8 = _yield$Promise$all2[7].data;\n            urgeResultLows = _yield$Promise$all2$8.data;\n            levelCode06 = _yield$Promise$all2$8.code;\n            _yield$Promise$all2$9 = _yield$Promise$all2[8].data;\n            urgeIsConnects = _yield$Promise$all2$9.data;\n            levelCode07 = _yield$Promise$all2$9.code;\n            _yield$Promise$all2$10 = _yield$Promise$all2[9].data;\n            urgeReasonTypes = _yield$Promise$all2$10.data;\n            levelCode08 = _yield$Promise$all2$10.code;\n            _yield$Promise$all2$11 = _yield$Promise$all2[10].data;\n            urgeRepayDesires = _yield$Promise$all2$11.data;\n            levelCode09 = _yield$Promise$all2$11.code;\n\n            if (!(code == 0)) {\n              _context3.next = 41;\n              break;\n            }\n\n            return _context3.abrupt(\"return\", {\n              collectionProducts: data,\n              collectionLevels: levelCode === 0 ? collectionLevels : [],\n              urgeMethods: levelCode01 === 0 ? urgeMethods : [],\n              urgeObjects: levelCode02 === 0 ? urgeObjects : [],\n              urgeResults: levelCode03 === 0 ? urgeResults : [],\n              urgeResultUnknows: levelCode04 === 0 ? urgeResultUnknows : [],\n              urgeResultHighs: levelCode05 === 0 ? urgeResultHighs : [],\n              urgeResultLows: levelCode06 === 0 ? urgeResultLows : [],\n              urgeIsConnects: levelCode07 === 0 ? urgeIsConnects : [],\n              urgeReasonTypes: levelCode08 === 0 ? urgeReasonTypes : [],\n              urgeRepayDesires: levelCode09 === 0 ? urgeRepayDesires : [],\n              id: context.ctx.query.id\n            });\n\n          case 41:\n            backData.code = code;\n            return _context3.abrupt(\"return\", backData);\n\n          case 45:\n            _context3.prev = 45;\n            _context3.t0 = _context3[\"catch\"](1);\n            console.log(_context3.t0);\n            return _context3.abrupt(\"return\", backData);\n\n          case 49:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, null, [[1, 45]]);\n  }));\n\n  return function (_x3) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nexport default body;","map":null,"metadata":{},"sourceType":"module"}